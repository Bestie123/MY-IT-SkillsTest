<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technologies Knowledge Base - Accordion View</title>
    <style>
        /* –í—Å–µ –≤–∞—à–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        /* ... –≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π CSS ... */

        /* –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø TIPTAP */
        .tiptap-editor {
            min-height: 400px;
            padding: 15px;
            border: 1px solid #e1e5e9;
            border-radius: 5px;
            background: white;
        }

        .tiptap-editor:focus {
            outline: none;
            border-color: #007bff;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ TipTap */
        .tiptap-editor h1 {
            font-size: 2em;
            margin: 0.67em 0;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 0.3em;
        }

        .tiptap-editor h2 {
            font-size: 1.5em;
            margin: 0.83em 0;
            color: #2c3e50;
            border-bottom: 1px solid #bdc3c7;
            padding-bottom: 0.3em;
        }

        .tiptap-editor h3 {
            font-size: 1.17em;
            margin: 1em 0;
            color: #2c3e50;
        }

        .tiptap-editor ul, .tiptap-editor ol {
            padding-left: 2em;
            margin: 1em 0;
        }

        .tiptap-editor blockquote {
            border-left: 4px solid #3498db;
            padding-left: 1em;
            margin: 1em 0;
            font-style: italic;
            color: #7f8c8d;
        }

        .tiptap-editor code {
            background: #f8f9fa;
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .tiptap-editor pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 1em;
            border-radius: 5px;
            overflow-x: auto;
            margin: 1em 0;
        }

        .tiptap-editor pre code {
            background: none;
            padding: 0;
            color: inherit;
        }

        .tiptap-editor table {
            width: 100%;
            border-collapse: collapse;
            margin: 1em 0;
        }

        .tiptap-editor table, 
        .tiptap-editor th, 
        .tiptap-editor td {
            border: 1px solid #bdc3c7;
        }

        .tiptap-editor th, 
        .tiptap-editor td {
            padding: 8px 12px;
            text-align: left;
        }

        .tiptap-editor th {
            background: #f8f9fa;
            font-weight: bold;
        }

        .tiptap-editor img {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
            margin: 10px 0;
        }

        .tiptap-editor .ProseMirror {
            outline: none;
        }

        .tiptap-editor .ProseMirror p.is-editor-empty:first-child::before {
            color: #adb5bd;
            content: attr(data-placeholder);
            float: left;
            height: 0;
            pointer-events: none;
        }

        /* –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ç—É–ª–±–∞—Ä–∞ */
        .editor-toolbar {
            background: #f8f9fa;
            padding: 10px;
            border: 1px solid #e1e5e9;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            align-items: center;
        }

        .editor-toolbar button {
            background: white;
            color: #495057;
            border: 1px solid #dee2e6;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .editor-toolbar button:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }

        .editor-toolbar button.is-active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .editor-toolbar select {
            padding: 6px 8px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            background: white;
            color: #495057;
        }

        .editor-toolbar .separator {
            width: 1px;
            height: 20px;
            background: #dee2e6;
            margin: 0 8px;
        }

        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∞—à–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è */
        /* ... –≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π CSS ... */
    </style>
    
    <!-- TipTap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tiptap/core@2.1.13/dist/tiptap.css">
</head>
<body>
    <div class="container">
        <!-- –í–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π HTML –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
        <!-- ... –≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π HTML ... -->

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –∑–Ω–∞–Ω–∏–π (–û–ë–ù–û–í–õ–ï–ù–û) -->
        <div id="knowledgeModal" class="modal knowledge-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="knowledgeTitle">–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</h3>
                    <button onclick="uiManager.hideModals()">‚úï</button>
                </div>
                
                <div class="content-tabs">
                    <div class="content-tab active" onclick="knowledgeManager.switchTab('editor')">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–æ—Ä</div>
                    <div class="content-tab" onclick="knowledgeManager.switchTab('preview')">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</div>
                    <div class="content-tab" onclick="knowledgeManager.switchTab('media')">üñºÔ∏è –ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã</div>
                    <div class="content-tab" onclick="knowledgeManager.switchTab('links')">üîó –°—Å—ã–ª–∫–∏</div>
                </div>
                
                <!-- –í–∫–ª–∞–¥–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ (–û–ë–ù–û–í–õ–ï–ù–ê) -->
                <div id="editorTab" class="tab-content active">
                    <div class="content-editor">
                        <div class="editor-toolbar" id="tiptapToolbar">
                            <!-- –ö–Ω–æ–ø–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                        </div>
                        <div id="knowledgeEditor" class="tiptap-editor"></div>
                    </div>
                </div>
                
                <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
                <!-- ... –≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π HTML ... -->
            </div>
        </div>

        <!-- –û—Å—Ç–∞–ª—å–Ω–æ–π –≤–∞—à HTML –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
        <!-- ... –≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π HTML ... -->
    </div>

    <!-- TipTap JS -->
    <script src="https://cdn.jsdelivr.net/npm/@tiptap/core@2.1.13/dist/tiptap.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tiptap/starter-kit@2.1.13/dist/starter-kit.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tiptap/extension-image@2.1.13/dist/image.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tiptap/extension-link@2.1.13/dist/link.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tiptap/extension-table@2.1.13/dist/table.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tiptap/extension-table-row@2.1.13/dist/table-row.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tiptap/extension-table-header@2.1.13/dist/table-header.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tiptap/extension-table-cell@2.1.13/dist/table-cell.umd.min.js"></script>

    <script>
        // === –û–ë–ù–û–í–õ–ï–ù–ù–´–ô –ö–û–î –î–õ–Ø –†–ï–î–ê–ö–¢–û–†–ê –ó–ù–ê–ù–ò–ô ===
        
        let tiptapEditor = null;

        const knowledgeEditor = {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TipTap —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
            init(element, content) {
                if (tiptapEditor) {
                    tiptapEditor.destroy();
                }

                tiptapEditor = new tiptap.Editor({
                    element: element,
                    extensions: [
                        tiptap.StarterKit.configure({
                            heading: {
                                levels: [1, 2, 3, 4]
                            }
                        }),
                        tiptap.Image.configure({
                            HTMLAttributes: {
                                class: 'embedded-image',
                            },
                        }),
                        tiptap.Link.configure({
                            HTMLAttributes: {
                                class: 'internal-link',
                            },
                            openOnClick: false,
                        }),
                        tiptap.Table.configure({
                            resizable: true,
                        }),
                        tiptap.TableRow,
                        tiptap.TableHeader,
                        tiptap.TableCell,
                    ],
                    content: content || '',
                    onUpdate: () => {
                        this.onContentUpdate();
                    },
                    editorProps: {
                        attributes: {
                            class: 'ProseMirror',
                            'data-placeholder': '–ù–∞—á–Ω–∏—Ç–µ –ø–∏—Å–∞—Ç—å –∑–¥–µ—Å—å...',
                        },
                    },
                });

                this.setupToolbar();
                return tiptapEditor;
            },

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞–Ω–µ–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
            setupToolbar() {
                const toolbar = document.getElementById('tiptapToolbar');
                if (!toolbar) return;

                toolbar.innerHTML = `
                    <select onchange="knowledgeEditor.formatHeading(this.value)">
                        <option value="">–¢–µ–∫—Å—Ç</option>
                        <option value="1">–ó–∞–≥–æ–ª–æ–≤–æ–∫ 1</option>
                        <option value="2">–ó–∞–≥–æ–ª–æ–≤–æ–∫ 2</option>
                        <option value="3">–ó–∞–≥–æ–ª–æ–≤–æ–∫ 3</option>
                        <option value="4">–ó–∞–≥–æ–ª–æ–≤–æ–∫ 4</option>
                    </select>

                    <div class="separator"></div>

                    <button onclick="knowledgeEditor.formatText('bold')" title="–ñ–∏—Ä–Ω—ã–π">
                        <b>B</b>
                    </button>
                    <button onclick="knowledgeEditor.formatText('italic')" title="–ö—É—Ä—Å–∏–≤">
                        <i>I</i>
                    </button>
                    <button onclick="knowledgeEditor.formatText('underline')" title="–ü–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ">
                        <u>U</u>
                    </button>

                    <div class="separator"></div>

                    <button onclick="knowledgeEditor.formatText('bulletList')" title="–ú–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫">
                        ‚Ä¢
                    </button>
                    <button onclick="knowledgeEditor.formatText('orderedList')" title="–ù—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫">
                        1.
                    </button>
                    <button onclick="knowledgeEditor.formatText('blockquote')" title="–¶–∏—Ç–∞—Ç–∞">
                        "
                    </button>
                    <button onclick="knowledgeEditor.formatText('codeBlock')" title="–ë–ª–æ–∫ –∫–æ–¥–∞">
                        {"{}"}
                    </button>

                    <div class="separator"></div>

                    <button onclick="knowledgeEditor.insertLink()" title="–í—Å—Ç–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É">
                        üîó
                    </button>
                    <button onclick="knowledgeEditor.insertImage()" title="–í—Å—Ç–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
                        üñºÔ∏è
                    </button>
                    <button onclick="knowledgeEditor.insertTable()" title="–í—Å—Ç–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É">
                        ‚ß†
                    </button>

                    <div class="separator"></div>

                    <button onclick="knowledgeEditor.insertInternalLink()" title="–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Å—ã–ª–∫–∞">
                        üìé
                    </button>
                    <button onclick="knowledgeEditor.clearFormat()" title="–û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ">
                        üßπ
                    </button>
                    <button onclick="knowledgeEditor.undo()" title="–û—Ç–º–µ–Ω–∏—Ç—å">
                        ‚Ü©Ô∏è
                    </button>
                    <button onclick="knowledgeEditor.redo()" title="–ü–æ–≤—Ç–æ—Ä–∏—Ç—å">
                        ‚Ü™Ô∏è
                    </button>
                `;

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–æ–∫
                this.updateToolbarState();
            },

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–Ω–æ–ø–æ–∫ —Ç—É–ª–±–∞—Ä–∞
            updateToolbarState() {
                if (!tiptapEditor) return;

                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
                const buttons = document.querySelectorAll('#tiptapToolbar button');
                buttons.forEach(button => {
                    const command = button.onclick?.toString().match(/knowledgeEditor\.(\w+)/)?.[1];
                    if (command) {
                        const isActive = this.isCommandActive(command);
                        button.classList.toggle('is-active', isActive);
                    }
                });
            },

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–æ–º–∞–Ω–¥—ã
            isCommandActive(command) {
                if (!tiptapEditor) return false;

                switch (command) {
                    case 'bold':
                        return tiptapEditor.isActive('bold');
                    case 'italic':
                        return tiptapEditor.isActive('italic');
                    case 'underline':
                        return tiptapEditor.isActive('underline');
                    case 'bulletList':
                        return tiptapEditor.isActive('bulletList');
                    case 'orderedList':
                        return tiptapEditor.isActive('orderedList');
                    case 'blockquote':
                        return tiptapEditor.isActive('blockquote');
                    case 'codeBlock':
                        return tiptapEditor.isActive('codeBlock');
                    default:
                        return false;
                }
            },

            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
            formatText(command) {
                if (!tiptapEditor) return;

                switch (command) {
                    case 'bold':
                        tiptapEditor.chain().focus().toggleBold().run();
                        break;
                    case 'italic':
                        tiptapEditor.chain().focus().toggleItalic().run();
                        break;
                    case 'underline':
                        // –î–ª—è –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è –Ω—É–∂–Ω–æ –∫–∞—Å—Ç–æ–º–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º CSS –∫–ª–∞—Å—Å
                        tiptapEditor.chain().focus().toggleMark('underline').run();
                        break;
                    case 'bulletList':
                        tiptapEditor.chain().focus().toggleBulletList().run();
                        break;
                    case 'orderedList':
                        tiptapEditor.chain().focus().toggleOrderedList().run();
                        break;
                    case 'blockquote':
                        tiptapEditor.chain().focus().toggleBlockquote().run();
                        break;
                    case 'codeBlock':
                        tiptapEditor.chain().focus().toggleCodeBlock().run();
                        break;
                }

                this.updateToolbarState();
            },

            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞
            formatHeading(level) {
                if (!tiptapEditor) return;
                
                if (level === '') {
                    tiptapEditor.chain().focus().setParagraph().run();
                } else {
                    tiptapEditor.chain().focus().toggleHeading({ level: parseInt(level) }).run();
                }
            },

            // –í—Å—Ç–∞–≤–∫–∞ —Å—Å—ã–ª–∫–∏
            insertLink() {
                if (!tiptapEditor) return;

                const url = prompt('–í–≤–µ–¥–∏—Ç–µ URL:');
                if (url) {
                    tiptapEditor.chain().focus().setLink({ href: url }).run();
                }
            },

            // –í—Å—Ç–∞–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            insertImage() {
                if (!tiptapEditor) return;

                const url = prompt('–í–≤–µ–¥–∏—Ç–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:');
                if (url) {
                    tiptapEditor.chain().focus().setImage({ src: url }).run();
                }
            },

            // –í—Å—Ç–∞–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
            insertTable() {
                if (!tiptapEditor) return;

                const rows = parseInt(prompt('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫:', '3')) || 3;
                const cols = parseInt(prompt('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–æ–ª–±—Ü–æ–≤:', '3')) || 3;

                tiptapEditor.chain().focus().insertTable({ 
                    rows: rows, 
                    cols: cols, 
                    withHeaderRow: true 
                }).run();
            },

            // –í—Å—Ç–∞–≤–∫–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å—Å—ã–ª–∫–∏
            insertInternalLink() {
                if (!tiptapEditor) return;

                const techName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:');
                if (techName) {
                    tiptapEditor.chain().focus().setLink({ 
                        href: `#${techName}`,
                        class: 'internal-link'
                    }).run();
                }
            },

            // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            clearFormat() {
                if (!tiptapEditor) return;
                tiptapEditor.chain().focus().clearNodes().unsetAllMarks().run();
            },

            // –û—Ç–º–µ–Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è
            undo() {
                if (!tiptapEditor) return;
                tiptapEditor.chain().focus().undo().run();
            },

            // –ü–æ–≤—Ç–æ—Ä –¥–µ–π—Å—Ç–≤–∏—è
            redo() {
                if (!tiptapEditor) return;
                tiptapEditor.chain().focus().redo().run();
            },

            // –ü–æ–ª—É—á–µ–Ω–∏–µ HTML –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            getHTML() {
                return tiptapEditor ? tiptapEditor.getHTML() : '';
            },

            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            setContent(content) {
                if (tiptapEditor) {
                    tiptapEditor.commands.setContent(content);
                }
            },

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            onContentUpdate() {
                this.updateToolbarState();
                knowledgeManager.renderPreview();
            },

            // –£–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
            destroy() {
                if (tiptapEditor) {
                    tiptapEditor.destroy();
                    tiptapEditor = null;
                }
            }
        };

        // === –û–ë–ù–û–í–õ–ï–ù–ù–´–ô –ö–û–î –î–õ–Ø –ú–ï–ù–ï–î–ñ–ï–†–ê –ó–ù–ê–ù–ò–ô ===
        
        const knowledgeManager = {
            currentItem: null,
            
            // –û—Ç–∫—Ä—ã—Ç–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞
            openKnowledgeBase(pathStr, index) {
                const path = JSON.parse(pathStr);
                const item = dataManager.getNodeAtIndex(path, index);
                
                if (!item) {
                    uiManager.showNotification('–≠–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                    return;
                }
                
                this.currentItem = item;
                currentKnowledgeItem = item;
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–ª—è, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
                if (!item.content) item.content = '';
                if (!item.media) item.media = [];
                if (!item.links) item.links = [];
                
                document.getElementById('knowledgeTitle').textContent = `–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π: ${item.name}`;
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º TipTap —Ä–µ–¥–∞–∫—Ç–æ—Ä
                knowledgeEditor.init(document.getElementById('knowledgeEditor'), item.content);
                
                this.renderPreview();
                this.renderMedia();
                this.renderLinks();
                
                uiManager.showModal('knowledgeModal');
            },
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            saveContent() {
                if (!this.currentItem) return;
                
                this.currentItem.content = knowledgeEditor.getHTML();
                this.scheduleSave();
                uiManager.showNotification('–ö–æ–Ω—Ç–µ–Ω—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');
            },
            
            // –†–µ–Ω–¥–µ—Ä –ø—Ä–µ–≤—å—é –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            renderPreview() {
                const content = knowledgeEditor.getHTML();
                document.getElementById('knowledgePreview').innerHTML = content;
                this.processInternalLinks();
            },

            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏
            switchTab(tabName) {
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
                document.querySelectorAll('.content-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
                document.getElementById(`${tabName}Tab`).classList.add('active');
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É –≤–∫–ª–∞–¥–∫–∏
                document.querySelectorAll('.content-tab').forEach(tab => {
                    if (tab.textContent.includes(this.getTabIcon(tabName))) {
                        tab.classList.add('active');
                    }
                });
                
                // –ï—Å–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä, –æ–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é
                if (tabName === 'preview') {
                    this.renderPreview();
                }
            },

            getTabIcon(tabName) {
                const icons = {
                    'editor': '‚úèÔ∏è',
                    'preview': 'üëÅÔ∏è',
                    'media': 'üñºÔ∏è',
                    'links': 'üîó'
                };
                return icons[tabName] || '';
            },

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å—Å—ã–ª–æ–∫ –≤ –ø—Ä–µ–≤—å—é
            processInternalLinks() {
                const internalLinks = document.querySelectorAll('.internal-link');
                internalLinks.forEach(link => {
                    link.onclick = (e) => {
                        e.preventDefault();
                        const targetId = link.getAttribute('href')?.replace('#', '');
                        if (targetId) {
                            this.navigateToInternalLink(targetId);
                        }
                    };
                });
            },

            // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º —Å—Å—ã–ª–∫–∞–º
            navigateToInternalLink(targetId) {
                uiManager.showNotification(`–ü–µ—Ä–µ—Ö–æ–¥ –∫: ${targetId}`, 'warning');
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –ø–æ–∏—Å–∫–∞ –∏ –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–≤—è–∑–∞–Ω–Ω–æ–π —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
            },

            // –û—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
            // ... –≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –¥–ª—è media, links –∏ —Ç.–¥. ...

            // –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            scheduleSave() {
                dataManager.saveToLocalStorage();
                authManager.scheduleAutoSave();
                accordionManager.renderAccordion();
            }
        };

        // === –û–ë–ù–û–í–õ–ï–ù–ò–ï UI MANAGER –î–õ–Ø –£–ù–ò–ß–¢–û–ñ–ï–ù–ò–Ø –†–ï–î–ê–ö–¢–û–†–ê ===
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤ uiManager.hideModals —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
        const originalHideModals = uiManager.hideModals;
        uiManager.hideModals = function() {
            originalHideModals.call(this);
            knowledgeEditor.destroy();
        };

        // –í–∞—à –æ—Å—Ç–∞–ª—å–Ω–æ–π JavaScript –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        // ... –≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π JavaScript ...
    </script>
</body>
</html>