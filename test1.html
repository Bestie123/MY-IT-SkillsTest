<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technologies Knowledge Base - Accordion View</title>
    <style>
        /* –í—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è */
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –∑–Ω–∞–Ω–∏–π */
        
        /* –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
        .content-editor {
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .editor-toolbar {
            background: #f8f9fa;
            padding: 8px;
            border-bottom: 1px solid #ddd;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .editor-toolbar button {
            background: white;
            color: #333;
            border: 1px solid #ddd;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .editor-toolbar button:hover {
            background: #e9ecef;
        }
        
        .editor-content {
            min-height: 300px;
            padding: 15px;
            font-family: Arial, sans-serif;
            line-height: 1.6;
        }
        
        .editor-content:focus {
            outline: none;
        }
        
        /* –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
        .knowledge-content {
            padding: 15px;
            line-height: 1.6;
        }
        
        .knowledge-content h1, 
        .knowledge-content h2, 
        .knowledge-content h3, 
        .knowledge-content h4 {
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            color: #2c3e50;
        }
        
        .knowledge-content h1 { font-size: 1.8em; border-bottom: 2px solid #3498db; padding-bottom: 5px; }
        .knowledge-content h2 { font-size: 1.5em; border-bottom: 1px solid #bdc3c7; padding-bottom: 3px; }
        .knowledge-content h3 { font-size: 1.3em; }
        .knowledge-content h4 { font-size: 1.1em; }
        
        .knowledge-content p {
            margin-bottom: 1em;
        }
        
        .knowledge-content ul, 
        .knowledge-content ol {
            margin-bottom: 1em;
            padding-left: 2em;
        }
        
        .knowledge-content blockquote {
            border-left: 4px solid #3498db;
            padding-left: 15px;
            margin: 1em 0;
            color: #7f8c8d;
            font-style: italic;
        }
        
        .knowledge-content code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .knowledge-content pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 1em 0;
        }
        
        .knowledge-content pre code {
            background: none;
            padding: 0;
            color: inherit;
        }
        
        .knowledge-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1em 0;
        }
        
        .knowledge-content table, 
        .knowledge-content th, 
        .knowledge-content td {
            border: 1px solid #bdc3c7;
        }
        
        .knowledge-content th, 
        .knowledge-content td {
            padding: 8px 12px;
            text-align: left;
        }
        
        .knowledge-content th {
            background: #f8f9fa;
        }
        
        .knowledge-content img {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
            margin: 10px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .knowledge-content video {
            max-width: 100%;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .internal-link {
            color: #3498db;
            text-decoration: none;
            border-bottom: 1px dashed #3498db;
            cursor: pointer;
        }
        
        .internal-link:hover {
            color: #2980b9;
            border-bottom: 1px solid #2980b9;
        }
        
        .media-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .media-item {
            position: relative;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .media-item img, 
        .media-item video {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        
        .media-item-actions {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 5px;
        }
        
        .media-item-actions button {
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            border-radius: 3px;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –∑–Ω–∞–Ω–∏–π */
        .knowledge-modal .modal-content {
            max-width: 900px;
            max-height: 90vh;
        }
        
        .content-tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 15px;
        }
        
        .content-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        
        .content-tab.active {
            border-bottom: 2px solid #3498db;
            color: #3498db;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .media-upload-area {
            border: 2px dashed #bdc3c7;
            border-radius: 5px;
            padding: 30px;
            text-align: center;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .media-upload-area:hover {
            border-color: #3498db;
            background: #f8f9fa;
        }
        
        .media-upload-area.dragover {
            border-color: #3498db;
            background: #e3f2fd;
        }
        
        .links-panel {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .link-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .link-item:last-child {
            border-bottom: none;
        }
        
        .search-box {
            margin: 10px 0;
            position: relative;
        }
        
        .search-box input {
            padding-right: 35px;
        }
        
        .search-icon {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
        }
        
        .knowledge-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .content-preview {
            max-height: 200px;
            overflow: hidden;
            position: relative;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #e9ecef;
            border-radius: 5px;
        }
        
        .content-preview:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40px;
            background: linear-gradient(transparent, white);
        }
        
        .knowledge-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: #e3f2fd;
            color: #1976d2;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-left: 10px;
        }
        
        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        .auth-section, .controls, .accordion-container, .modal, .notification, 
        .accordion-item, .accordion-header, .checklist-item, etc. {
            /* –í—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å—Ç–∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è */
        }
    </style>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Markdown (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>üìö Technologies Knowledge Base - Accordion View</h1>
        
        <!-- –°–µ–∫—Ü–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) -->
        <div class="auth-section" id="authSection">
            <h3>üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ GitHub</h3>
            <div>
                <input type="password" id="githubToken" placeholder="GitHub Personal Access Token" style="width: 300px;">
                <input type="text" id="repoOwner" placeholder="–í–ª–∞–¥–µ–ª–µ—Ü —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è" style="width: 150px;">
                <input type="text" id="repoName" placeholder="–ò–º—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è" style="width: 150px;">
                <button onclick="authManager.saveAuth()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                <button onclick="authManager.testAuth()" class="success">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</button>
            </div>
            <div id="syncStatus" class="sync-status"></div>
            <div id="authStatus" class="auth-status"></div>
            <p><small>–¢–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ. –°–æ–∑–¥–∞–π—Ç–µ —Ç–æ–∫–µ–Ω –≤ GitHub —Å –ø—Ä–∞–≤–∞–º–∏ repo</small></p>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∫–Ω–æ–ø–æ–∫ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –∑–Ω–∞–Ω–∏–π -->
        <div class="controls">
            <div>
                <button onclick="uiManager.showModal('categoryModal')">+ –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                <button onclick="uiManager.showAddNodeModal()">+ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                <button onclick="uiManager.showAddTechModal()">+ –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é</button>
                <button onclick="authManager.loadFromGitHub()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å GitHub</button>
                <button onclick="authManager.saveToGitHub()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞ GitHub</button>
                <button onclick="authManager.forceSync()">üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</button>
                <button onclick="authManager.toggleAutoSave()" id="autoSaveBtn">üö´ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</button>
                <button onclick="dataManager.exportToJSON()">üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON</button>
                <button onclick="dataManager.importFromJSON()">üì§ –ò–º–ø–æ—Ä—Ç –∏–∑ JSON</button>
                <button onclick="knowledgeManager.showGlobalSearch()" class="success">üîç –ü–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π</button>
            </div>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–∞ -->
        <div id="accordionContainer" class="accordion-container">
            <div id="accordion" class="accordion"></div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ + –Ω–æ–≤—ã–µ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –∑–Ω–∞–Ω–∏–π) -->
        
        <!-- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ (categoryModal, nodeModal, techModal, checklistModal) -->
        
        <!-- –ù–æ–≤–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –∑–Ω–∞–Ω–∏–π -->
        <div id="knowledgeModal" class="modal knowledge-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="knowledgeTitle">–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</h3>
                    <button onclick="uiManager.hideModals()">‚úï</button>
                </div>
                
                <div class="content-tabs">
                    <div class="content-tab active" onclick="knowledgeManager.switchTab('editor')">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–æ—Ä</div>
                    <div class="content-tab" onclick="knowledgeManager.switchTab('preview')">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</div>
                    <div class="content-tab" onclick="knowledgeManager.switchTab('media')">üñºÔ∏è –ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã</div>
                    <div class="content-tab" onclick="knowledgeManager.switchTab('links')">üîó –°—Å—ã–ª–∫–∏</div>
                </div>
                
                <!-- –í–∫–ª–∞–¥–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ -->
                <div id="editorTab" class="tab-content active">
                    <div class="content-editor">
                        <div class="editor-toolbar">
                            <button onclick="knowledgeEditor.formatText('bold')" title="–ñ–∏—Ä–Ω—ã–π"><b>B</b></button>
                            <button onclick="knowledgeEditor.formatText('italic')" title="–ö—É—Ä—Å–∏–≤"><i>I</i></button>
                            <button onclick="knowledgeEditor.formatText('underline')" title="–ü–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ"><u>U</u></button>
                            <button onclick="knowledgeEditor.insertHeading(1)" title="–ó–∞–≥–æ–ª–æ–≤–æ–∫ 1">H1</button>
                            <button onclick="knowledgeEditor.insertHeading(2)" title="–ó–∞–≥–æ–ª–æ–≤–æ–∫ 2">H2</button>
                            <button onclick="knowledgeEditor.insertHeading(3)" title="–ó–∞–≥–æ–ª–æ–≤–æ–∫ 3">H3</button>
                            <button onclick="knowledgeEditor.insertList('ul')" title="–ú–∞—Ä–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫">‚Ä¢</button>
                            <button onclick="knowledgeEditor.insertList('ol')" title="–ù—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫">1.</button>
                            <button onclick="knowledgeEditor.insertLink()" title="–í—Å—Ç–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É">üîó</button>
                            <button onclick="knowledgeEditor.insertCode()" title="–í—Å—Ç–∞–≤–∏—Ç—å –∫–æ–¥">{"{}"}</button>
                            <button onclick="knowledgeEditor.insertTable()" title="–í—Å—Ç–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É">‚ß†</button>
                            <button onclick="knowledgeEditor.insertImage()" title="–í—Å—Ç–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">üñºÔ∏è</button>
                            <button onclick="knowledgeEditor.insertVideo()" title="–í—Å—Ç–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ">üé¨</button>
                            <button onclick="knowledgeEditor.insertInternalLink()" title="–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Å—ã–ª–∫–∞">üìé</button>
                        </div>
                        <div id="knowledgeEditor" class="editor-content" contenteditable="true"></div>
                    </div>
                </div>
                
                <!-- –í–∫–ª–∞–¥–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ -->
                <div id="previewTab" class="tab-content">
                    <div id="knowledgePreview" class="knowledge-content"></div>
                </div>
                
                <!-- –í–∫–ª–∞–¥–∫–∞ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤ -->
                <div id="mediaTab" class="tab-content">
                    <div class="media-upload-area" id="mediaDropZone">
                        üìÅ –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–ª–∏ –≤–∏–¥–µ–æ<br>
                        <small>–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–æ–≤</small>
                        <input type="file" id="mediaUpload" multiple accept="image/*,video/*" style="display: none;">
                    </div>
                    <div id="mediaGallery" class="media-gallery">
                        <!-- –ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                    </div>
                </div>
                
                <!-- –í–∫–ª–∞–¥–∫–∞ —Å—Å—ã–ª–æ–∫ -->
                <div id="linksTab" class="tab-content">
                    <div class="search-box">
                        <input type="text" id="linkSearch" placeholder="–ü–æ–∏—Å–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π...">
                        <span class="search-icon">üîç</span>
                    </div>
                    <div id="linksList" class="links-panel">
                        <!-- –°–ø–∏—Å–æ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –¥–ª—è —Å—Å—ã–ª–æ–∫ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                    </div>
                </div>
                
                <div class="knowledge-actions">
                    <div>
                        <button onclick="knowledgeManager.saveContent()" class="success">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button onclick="knowledgeManager.exportContent()">üì• –≠–∫—Å–ø–æ—Ä—Ç</button>
                        <button onclick="knowledgeManager.importContent()">üì§ –ò–º–ø–æ—Ä—Ç</button>
                    </div>
                    <button onclick="uiManager.hideModals()">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>
        
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π -->
        <div id="searchModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>üîç –ü–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π</h3>
                    <button onclick="uiManager.hideModals()">‚úï</button>
                </div>
                <div class="search-box">
                    <input type="text" id="globalSearch" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å...">
                    <span class="search-icon">üîç</span>
                </div>
                <div id="searchResults" style="max-height: 400px; overflow-y: auto; margin-top: 15px;">
                    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>
        </div>

        <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –∏ —Å–µ–∫—Ü–∏–∏ -->
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å—é
        const techData = {
            categories: []
        };

        // –¢–µ–∫—É—â–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—É—Ç—å –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        let currentModalPath = [];

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        let lastKnownRemoteSha = null;
        let lastSyncTime = null;

        // –¢–µ–∫—É—â–∏–π —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –∑–Ω–∞–Ω–∏–π
        let currentKnowledgeItem = null;

        // –ú–µ–Ω–µ–¥–∂–µ—Ä –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–∞ (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π)
        const accordionManager = {
            // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–∞ ...
            
            // –í buildAccordion –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
            buildAccordion(nodes, parentElement, path) {
                nodes.forEach((node, index) => {
                    // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —Å–æ–∑–¥–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–∞ –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–∞ ...
                    
                    // –í —Ä–∞–∑–¥–µ–ª –¥–µ–π—Å—Ç–≤–∏–π –¥–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
                    const actions = document.createElement('div');
                    actions.className = 'accordion-actions';
                    
                    if (node.type === 'technology') {
                        actions.innerHTML = `
                            <button onclick="knowledgeManager.openKnowledgeBase('${JSON.stringify(path)}', ${index})" title="–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π" style="background: #9c27b0;">üìö</button>
                            <button onclick="checklistManager.manageChecklist('${JSON.stringify(path)}', ${index})" class="warning" title="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ–∫-–ª–∏—Å—Ç–æ–º">üìã</button>
                            <button onclick="dataManager.editTechnology('${JSON.stringify(path)}', ${index})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
                            <button class="delete" onclick="dataManager.deleteTechnology('${JSON.stringify(path)}', ${index})" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                        `;
                    } else {
                        // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π ...
                    }
                    
                    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–∞ ...
                });
            },
            
            // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–∞ ...
        };

        // –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–Ω–∞–Ω–∏—è–º–∏
        const knowledgeManager = {
            currentItem: null,
            
            // –û—Ç–∫—Ä—ã—Ç–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞
            openKnowledgeBase(pathStr, index) {
                const path = JSON.parse(pathStr);
                const item = dataManager.getNodeAtIndex(path, index);
                
                if (!item) {
                    uiManager.showNotification('–≠–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                    return;
                }
                
                this.currentItem = item;
                currentKnowledgeItem = item;
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–ª–µ content, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
                if (!item.content) {
                    item.content = '';
                }
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
                if (!item.media) {
                    item.media = [];
                }
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Å—ã–ª–∫–∏, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
                if (!item.links) {
                    item.links = [];
                }
                
                document.getElementById('knowledgeTitle').textContent = `–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π: ${item.name}`;
                document.getElementById('knowledgeEditor').innerHTML = item.content || '';
                this.renderPreview();
                this.renderMedia();
                this.renderLinks();
                
                uiManager.showModal('knowledgeModal');
            },
            
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏
            switchTab(tabName) {
                // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
                document.querySelectorAll('.content-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
                document.getElementById(`${tabName}Tab`).classList.add('active');
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É –≤–∫–ª–∞–¥–∫–∏
                document.querySelectorAll('.content-tab').forEach(tab => {
                    if (tab.textContent.includes(this.getTabIcon(tabName))) {
                        tab.classList.add('active');
                    }
                });
                
                // –ï—Å–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä, –æ–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é
                if (tabName === 'preview') {
                    this.renderPreview();
                }
            },
            
            getTabIcon(tabName) {
                const icons = {
                    'editor': '‚úèÔ∏è',
                    'preview': 'üëÅÔ∏è',
                    'media': 'üñºÔ∏è',
                    'links': 'üîó'
                };
                return icons[tabName] || '';
            },
            
            // –†–µ–Ω–¥–µ—Ä –ø—Ä–µ–≤—å—é –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            renderPreview() {
                const content = document.getElementById('knowledgeEditor').innerHTML;
                document.getElementById('knowledgePreview').innerHTML = content;
                
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Å—ã–ª–∫–∏
                this.processInternalLinks();
            },
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å—Å—ã–ª–æ–∫ –≤ –ø—Ä–µ–≤—å—é
            processInternalLinks() {
                const internalLinks = document.querySelectorAll('.internal-link');
                internalLinks.forEach(link => {
                    link.onclick = (e) => {
                        e.preventDefault();
                        const targetId = link.getAttribute('data-target');
                        this.navigateToInternalLink(targetId);
                    };
                });
            },
            
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º —Å—Å—ã–ª–∫–∞–º
            navigateToInternalLink(targetId) {
                // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ª–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ ID –∏ –æ—Ç–∫—Ä—ã—Ç–∏—è –µ–≥–æ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
                uiManager.showNotification(`–ü–µ—Ä–µ—Ö–æ–¥ –∫: ${targetId}`, 'warning');
                // –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –ø–æ–∏—Å–∫ —ç–ª–µ–º–µ–Ω—Ç–∞ –∏ –æ—Ç–∫—Ä—ã—Ç–∏–µ –µ–≥–æ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
            },
            
            // –†–µ–Ω–¥–µ—Ä –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤
            renderMedia() {
                const gallery = document.getElementById('mediaGallery');
                gallery.innerHTML = '';
                
                if (!this.currentItem.media || this.currentItem.media.length === 0) {
                    gallery.innerHTML = '<p style="text-align: center; color: #6c757d;">–ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>';
                    return;
                }
                
                this.currentItem.media.forEach((media, index) => {
                    const mediaItem = document.createElement('div');
                    mediaItem.className = 'media-item';
                    
                    if (media.type === 'image') {
                        mediaItem.innerHTML = `
                            <img src="${media.data}" alt="${media.name}">
                            <div class="media-item-actions">
                                <button onclick="knowledgeManager.deleteMedia(${index})" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                                <button onclick="knowledgeManager.insertMediaToEditor('${media.data}', '${media.type}')" title="–í—Å—Ç–∞–≤–∏—Ç—å –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä">üìù</button>
                            </div>
                        `;
                    } else if (media.type === 'video') {
                        mediaItem.innerHTML = `
                            <video controls>
                                <source src="${media.data}" type="${media.mimeType}">
                                –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
                            </video>
                            <div class="media-item-actions">
                                <button onclick="knowledgeManager.deleteMedia(${index})" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                                <button onclick="knowledgeManager.insertMediaToEditor('${media.data}', '${media.type}')" title="–í—Å—Ç–∞–≤–∏—Ç—å –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä">üìù</button>
                            </div>
                        `;
                    }
                    
                    gallery.appendChild(mediaItem);
                });
            },
            
            // –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ —Å—Å—ã–ª–æ–∫
            renderLinks() {
                const linksList = document.getElementById('linksList');
                linksList.innerHTML = '';
                
                // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Å—ã–ª–æ–∫
                const allTech = this.getAllTechnologies();
                
                if (allTech.length === 0) {
                    linksList.innerHTML = '<p style="text-align: center; color: #6c757d;">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
                    return;
                }
                
                allTech.forEach(tech => {
                    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–µ–∫—É—â–∏–π —ç–ª–µ–º–µ–Ω—Ç
                    if (tech === this.currentItem) return;
                    
                    const isLinked = this.currentItem.links && 
                                    this.currentItem.links.some(link => link.id === tech.id);
                    
                    const linkItem = document.createElement('div');
                    linkItem.className = 'link-item';
                    linkItem.innerHTML = `
                        <span>${tech.name}</span>
                        <button onclick="knowledgeManager.toggleLink('${tech.id}')" 
                                class="${isLinked ? 'success' : ''}">
                            ${isLinked ? '‚úÖ' : 'üîó'}
                        </button>
                    `;
                    
                    linksList.appendChild(linkItem);
                });
            },
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
            getAllTechnologies() {
                const technologies = [];
                
                function traverse(nodes) {
                    nodes.forEach(node => {
                        if (node.type === 'technology') {
                            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
                            if (!node.id) {
                                node.id = 'tech_' + Math.random().toString(36).substr(2, 9);
                            }
                            technologies.push(node);
                        }
                        
                        if (node.children) {
                            traverse(node.children);
                        }
                    });
                }
                
                traverse(techData.categories);
                return technologies;
            },
            
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏
            toggleLink(techId) {
                if (!this.currentItem.links) {
                    this.currentItem.links = [];
                }
                
                const existingIndex = this.currentItem.links.findIndex(link => link.id === techId);
                
                if (existingIndex >= 0) {
                    // –£–¥–∞–ª—è–µ–º —Å—Å—ã–ª–∫—É
                    this.currentItem.links.splice(existingIndex, 1);
                } else {
                    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É
                    const targetTech = this.findTechnologyById(techId);
                    if (targetTech) {
                        this.currentItem.links.push({
                            id: techId,
                            name: targetTech.name,
                            path: this.getPathToTechnology(targetTech)
                        });
                    }
                }
                
                this.renderLinks();
                this.scheduleSave();
            },
            
            // –ü–æ–∏—Å–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –ø–æ ID
            findTechnologyById(id) {
                function findInNodes(nodes) {
                    for (const node of nodes) {
                        if (node.id === id) {
                            return node;
                        }
                        
                        if (node.children) {
                            const found = findInNodes(node.children);
                            if (found) return found;
                        }
                    }
                    return null;
                }
                
                return findInNodes(techData.categories);
            },
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—É—Ç–∏ –∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
            getPathToTechnology(tech) {
                // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—É—Ç—å –∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–∞–Ω–Ω—ã—Ö
                // –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ–π—Ç–∏ –ø–æ –≤—Å–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∏ –Ω–∞–π—Ç–∏ –ø—É—Ç—å
                return [];
            },
            
            // –£–¥–∞–ª–µ–Ω–∏–µ –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞
            deleteMedia(index) {
                if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –º–µ–¥–∏–∞—Ñ–∞–π–ª?')) {
                    this.currentItem.media.splice(index, 1);
                    this.renderMedia();
                    this.scheduleSave();
                }
            },
            
            // –í—Å—Ç–∞–≤–∫–∞ –º–µ–¥–∏–∞ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä
            insertMediaToEditor(data, type) {
                let insertHtml = '';
                
                if (type === 'image') {
                    insertHtml = `<img src="${data}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" style="max-width: 100%;">`;
                } else if (type === 'video') {
                    insertHtml = `<video controls style="max-width: 100%;"><source src="${data}"></video>`;
                }
                
                knowledgeEditor.insertHtml(insertHtml);
                this.switchTab('editor');
            },
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            saveContent() {
                if (!this.currentItem) return;
                
                this.currentItem.content = document.getElementById('knowledgeEditor').innerHTML;
                this.scheduleSave();
                uiManager.showNotification('–ö–æ–Ω—Ç–µ–Ω—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');
            },
            
            // –≠–∫—Å–ø–æ—Ä—Ç –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            exportContent() {
                const content = this.currentItem.content;
                const blob = new Blob([content], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${this.currentItem.name}.html`;
                a.click();
                URL.revokeObjectURL(url);
            },
            
            // –ò–º–ø–æ—Ä—Ç –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            importContent() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.html,.txt';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        document.getElementById('knowledgeEditor').innerHTML = e.target.result;
                        this.renderPreview();
                        uiManager.showNotification('–ö–æ–Ω—Ç–µ–Ω—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω!', 'success');
                    };
                    reader.readAsText(file);
                };
                input.click();
            },
            
            // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫
            showGlobalSearch() {
                uiManager.showModal('searchModal');
                document.getElementById('globalSearch').focus();
            },
            
            // –ü–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
            performSearch() {
                const query = document.getElementById('globalSearch').value.toLowerCase();
                const results = document.getElementById('searchResults');
                results.innerHTML = '';
                
                if (!query) {
                    results.innerHTML = '<p style="text-align: center; color: #6c757d;">–í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å</p>';
                    return;
                }
                
                const searchResults = this.searchInKnowledgeBase(query);
                
                if (searchResults.length === 0) {
                    results.innerHTML = '<p style="text-align: center; color: #6c757d;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>';
                    return;
                }
                
                searchResults.forEach(result => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'search-result-item';
                    resultItem.style.padding = '10px';
                    resultItem.style.borderBottom = '1px solid #e9ecef';
                    resultItem.style.cursor = 'pointer';
                    
                    resultItem.innerHTML = `
                        <div style="font-weight: bold;">${result.item.name}</div>
                        <div style="font-size: 0.9em; color: #6c757d;">${result.context}</div>
                    `;
                    
                    resultItem.onclick = () => {
                        this.openKnowledgeBase(JSON.stringify(result.path), result.index);
                        uiManager.hideModals();
                    };
                    
                    results.appendChild(resultItem);
                });
            },
            
            // –ü–æ–∏—Å–∫ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
            searchInKnowledgeBase(query) {
                const results = [];
                
                function searchInNodes(nodes, path = []) {
                    nodes.forEach((node, index) => {
                        // –ü–æ–∏—Å–∫ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏
                        if (node.name.toLowerCase().includes(query)) {
                            results.push({
                                item: node,
                                path: [...path],
                                index: index,
                                context: `–ù–∞–∑–≤–∞–Ω–∏–µ: ${node.name}`
                            });
                        }
                        
                        // –ü–æ–∏—Å–∫ –≤ –∫–æ–Ω—Ç–µ–Ω—Ç–µ
                        if (node.content && node.content.toLowerCase().includes(query)) {
                            const contentPreview = node.content.replace(/<[^>]*>/g, '').substring(0, 100) + '...';
                            results.push({
                                item: node,
                                path: [...path],
                                index: index,
                                context: `–ö–æ–Ω—Ç–µ–Ω—Ç: ${contentPreview}`
                            });
                        }
                        
                        // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –≤ –¥–µ—Ç—è—Ö
                        if (node.children) {
                            searchInNodes(node.children, [...path, index]);
                        }
                    });
                }
                
                searchInNodes(techData.categories);
                return results;
            },
            
            // –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            scheduleSave() {
                dataManager.saveToLocalStorage();
                authManager.scheduleAutoSave();
            }
        };

        // –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        const knowledgeEditor = {
            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
            formatText(command, value = null) {
                document.execCommand(command, false, value);
                document.getElementById('knowledgeEditor').focus();
            },
            
            // –í—Å—Ç–∞–≤–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞
            insertHeading(level) {
                this.formatText('formatBlock', `<h${level}>`);
            },
            
            // –í—Å—Ç–∞–≤–∫–∞ —Å–ø–∏—Å–∫–∞
            insertList(type) {
                this.formatText(type === 'ul' ? 'insertUnorderedList' : 'insertOrderedList');
            },
            
            // –í—Å—Ç–∞–≤–∫–∞ —Å—Å—ã–ª–∫–∏
            insertLink() {
                const url = prompt('–í–≤–µ–¥–∏—Ç–µ URL:');
                if (url) {
                    this.formatText('createLink', url);
                }
            },
            
            // –í—Å—Ç–∞–≤–∫–∞ –∫–æ–¥–∞
            insertCode() {
                const code = prompt('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥:');
                if (code) {
                    this.insertHtml(`<pre><code>${code}</code></pre>`);
                }
            },
            
            // –í—Å—Ç–∞–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
            insertTable() {
                const rows = parseInt(prompt('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫:', '3')) || 3;
                const cols = parseInt(prompt('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–æ–ª–±—Ü–æ–≤:', '3')) || 3;
                
                let tableHtml = '<table style="width: 100%; border-collapse: collapse;">';
                
                for (let i = 0; i < rows; i++) {
                    tableHtml += '<tr>';
                    for (let j = 0; j < cols; j++) {
                        tableHtml += `<td style="border: 1px solid #ddd; padding: 8px;">&nbsp;</td>`;
                    }
                    tableHtml += '</tr>';
                }
                
                tableHtml += '</table>';
                this.insertHtml(tableHtml);
            },
            
            // –í—Å—Ç–∞–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            insertImage() {
                const url = prompt('–í–≤–µ–¥–∏—Ç–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:');
                if (url) {
                    this.insertHtml(`<img src="${url}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" style="max-width: 100%;">`);
                }
            },
            
            // –í—Å—Ç–∞–≤–∫–∞ –≤–∏–¥–µ–æ
            insertVideo() {
                const url = prompt('–í–≤–µ–¥–∏—Ç–µ URL –≤–∏–¥–µ–æ:');
                if (url) {
                    this.insertHtml(`<video controls style="max-width: 100%;"><source src="${url}"></video>`);
                }
            },
            
            // –í—Å—Ç–∞–≤–∫–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å—Å—ã–ª–∫–∏
            insertInternalLink() {
                // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –¥–ª—è —Å—Å—ã–ª–∫–∏
                const techName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:');
                if (techName) {
                    this.insertHtml(`<a href="#" class="internal-link" data-target="${techName}">${techName}</a>`);
                }
            },
            
            // –í—Å—Ç–∞–≤–∫–∞ HTML
            insertHtml(html) {
                const editor = document.getElementById('knowledgeEditor');
                const selection = window.getSelection();
                
                if (selection.rangeCount) {
                    const range = selection.getRangeAt(0);
                    range.deleteContents();
                    
                    const div = document.createElement('div');
                    div.innerHTML = html;
                    const fragment = document.createDocumentFragment();
                    
                    while (div.firstChild) {
                        fragment.appendChild(div.firstChild);
                    }
                    
                    range.insertNode(fragment);
                } else {
                    editor.innerHTML += html;
                }
                
                editor.focus();
            }
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–¥–∏–∞
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è drag & drop –¥–ª—è –º–µ–¥–∏–∞
            const dropZone = document.getElementById('mediaDropZone');
            const fileInput = document.getElementById('mediaUpload');
            
            dropZone.addEventListener('click', () => {
                fileInput.click();
            });
            
            fileInput.addEventListener('change', (e) => {
                knowledgeManager.handleFiles(e.target.files);
            });
            
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('dragover');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                knowledgeManager.handleFiles(e.dataTransfer.files);
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞
            document.getElementById('globalSearch').addEventListener('input', () => {
                knowledgeManager.performSearch();
            });
            
            document.getElementById('linkSearch').addEventListener('input', () => {
                knowledgeManager.filterLinks();
            });
        });

        // –†–∞—Å—à–∏—Ä—è–µ–º knowledgeManager –º–µ—Ç–æ–¥–∞–º–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏
        knowledgeManager.handleFiles = function(files) {
            for (const file of files) {
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    const mediaType = file.type.startsWith('image/') ? 'image' : 
                                    file.type.startsWith('video/') ? 'video' : 'other';
                    
                    if (mediaType === 'other') {
                        uiManager.showNotification('–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞', 'error');
                        return;
                    }
                    
                    if (!this.currentItem.media) {
                        this.currentItem.media = [];
                    }
                    
                    this.currentItem.media.push({
                        name: file.name,
                        type: mediaType,
                        data: e.target.result,
                        mimeType: file.type,
                        size: file.size
                    });
                    
                    this.renderMedia();
                    this.scheduleSave();
                    uiManager.showNotification(`–§–∞–π–ª "${file.name}" –∑–∞–≥—Ä—É–∂–µ–Ω`, 'success');
                };
                
                reader.readAsDataURL(file);
            }
        };

        knowledgeManager.filterLinks = function() {
            const query = document.getElementById('linkSearch').value.toLowerCase();
            const linkItems = document.querySelectorAll('.link-item');
            
            linkItems.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(query) ? 'flex' : 'none';
            });
        };

        // –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ (dataManager, uiManager, checklistManager, authManager) –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        // –Ω–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π (content, media, links) –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏/–∑–∞–≥—Ä—É–∑–∫–µ

        // –í dataManager –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è/–∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏
        // –í authManager –Ω—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–æ–≤—ã–µ –ø–æ–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–µ—Ä–∏–∞–ª–∏–∑—É—é—Ç—Å—è –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∞ GitHub

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            authManager.loadAuth();
            dataManager.loadFromLocalStorage();
            accordionManager.init();
            authManager.updateSyncStatus();
        });

        // –û—Å—Ç–∞–ª—å–Ω–æ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ (dataManager, uiManager, checklistManager, authManager) 
        // –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, –Ω–æ –Ω—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏
    </script>
</body>
</html>
