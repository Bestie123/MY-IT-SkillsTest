<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technologies Knowledge Base - Accordion View</title>
    
    <!-- MODULE: STYLES -->
    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .auth-section {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid #ffeaa7;
        }

        .controls {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin: 2px;
        }

        button:hover {
            background: #0056b3;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .accordion-container {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 5px;
            min-height: 500px;
            overflow: auto;
        }

        .accordion {
            width: 100%;
        }

        .accordion-item {
            margin-bottom: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
        }

        .accordion-header {
            padding: 12px 15px;
            background: #f8f9fa;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
            user-select: none;
        }

        .accordion-header:hover {
            background: #e9ecef;
        }

        .accordion-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            background: white;
        }

        .accordion-content.expanded {
            max-height: 5000px;
        }

        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –∑–Ω–∞–Ω–∏–π */
        .content-editor {
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .editor-toolbar {
            background: #f8f9fa;
            padding: 8px;
            border-bottom: 1px solid #ddd;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        
        .knowledge-content {
            padding: 15px;
            line-height: 1.6;
        }
        
        .knowledge-content h1 { 
            font-size: 1.8em; 
            border-bottom: 2px solid #3498db; 
            padding-bottom: 5px; 
        }
        
        .hidden {
            display: none;
        }
        
        /* ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ ... */
    </style>
</head>
<body>
    <div class="container">
        <!-- MODULE: HEADER -->
        <h1>üìö Technologies Knowledge Base - Accordion View</h1>
        
        <!-- MODULE: AUTH_SECTION -->
        <div class="auth-section" id="authSection">
            <h3>üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ GitHub</h3>
            <div>
                <input type="password" id="githubToken" placeholder="GitHub Personal Access Token" style="width: 300px;">
                <input type="text" id="repoOwner" placeholder="–í–ª–∞–¥–µ–ª–µ—Ü —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è" style="width: 150px;">
                <input type="text" id="repoName" placeholder="–ò–º—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è" style="width: 150px;">
                <button onclick="authManager.saveAuth()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                <button onclick="authManager.testAuth()" class="success">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</button>
            </div>
            <div id="syncStatus" class="sync-status"></div>
            <div id="authStatus" class="auth-status"></div>
            <p><small>–¢–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ. –°–æ–∑–¥–∞–π—Ç–µ —Ç–æ–∫–µ–Ω –≤ GitHub —Å –ø—Ä–∞–≤–∞–º–∏ repo</small></p>
        </div>

        <!-- MODULE: CONTROLS -->
        <div class="controls">
            <div>
                <button onclick="uiManager.showModal('categoryModal')">+ –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                <button onclick="uiManager.showAddNodeModal()">+ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                <button onclick="uiManager.showAddTechModal()">+ –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é</button>
                <button onclick="authManager.loadFromGitHub()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å GitHub</button>
                <button onclick="authManager.saveToGitHub()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞ GitHub</button>
                <button onclick="authManager.toggleAutoSave()" id="autoSaveBtn">üö´ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</button>
                <button onclick="knowledgeManager.showGlobalSearch()" class="success">üîç –ü–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π</button>
            </div>
        </div>

        <!-- MODULE: ACCORDION_CONTAINER -->
        <div id="accordionContainer" class="accordion-container">
            <div id="accordion" class="accordion"></div>
        </div>

        <!-- MODULE: MODALS -->
        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
        <div id="categoryModal" class="modal">
            <div class="modal-content">
                <h3>–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
                <input type="text" id="newCategoryName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏">
                <div>
                    <button onclick="dataManager.addCategory()">–î–æ–±–∞–≤–∏—Ç—å</button>
                    <button onclick="uiManager.hideModals()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
        <div id="nodeModal" class="modal">
            <div class="modal-content">
                <h3>–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
                <div id="nodeParentSelect"></div>
                <input type="text" id="newNodeName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏">
                <div>
                    <button onclick="dataManager.addNode()">–î–æ–±–∞–≤–∏—Ç—å</button>
                    <button onclick="uiManager.hideModals()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ -->
        <div id="techModal" class="modal">
            <div class="modal-content">
                <h3>–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é</h3>
                <div id="techParentSelect"></div>
                <input type="text" id="newTechName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏">
                <div>
                    <button onclick="dataManager.addTechnology()">–î–æ–±–∞–≤–∏—Ç—å</button>
                    <button onclick="uiManager.hideModals()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π -->
        <div id="knowledgeModal" class="modal knowledge-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="knowledgeTitle">–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</h3>
                    <button onclick="uiManager.hideModals()">‚úï</button>
                </div>
                
                <div class="content-tabs">
                    <div class="content-tab active" onclick="knowledgeManager.switchTab('editor')">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–æ—Ä</div>
                    <div class="content-tab" onclick="knowledgeManager.switchTab('preview')">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</div>
                </div>
                
                <div id="editorTab" class="tab-content active">
                    <div class="content-editor">
                        <div class="editor-toolbar">
                            <button onclick="knowledgeEditor.formatText('bold')" title="–ñ–∏—Ä–Ω—ã–π"><b>B</b></button>
                            <button onclick="knowledgeEditor.formatText('italic')" title="–ö—É—Ä—Å–∏–≤"><i>I</i></button>
                            <button onclick="knowledgeEditor.insertHeading(1)" title="–ó–∞–≥–æ–ª–æ–≤–æ–∫ 1">H1</button>
                            <button onclick="knowledgeEditor.insertHeading(2)" title="–ó–∞–≥–æ–ª–æ–≤–æ–∫ 2">H2</button>
                        </div>
                        <div id="knowledgeEditor" class="editor-content" contenteditable="true"></div>
                    </div>
                </div>
                
                <div id="previewTab" class="tab-content">
                    <div id="knowledgePreview" class="knowledge-content"></div>
                </div>
                
                <div class="knowledge-actions">
                    <button onclick="knowledgeManager.saveContent()" class="success">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button onclick="uiManager.hideModals()">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- MODULE: JSON_SECTION -->
        <div id="jsonSection" class="hidden">
            <h3>JSON –¥–∞–Ω–Ω—ã–µ:</h3>
            <textarea id="jsonOutput" style="width: 100%; height: 200px;"></textarea>
            <div>
                <button onclick="dataManager.copyToClipboard()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å JSON</button>
                <button onclick="dataManager.importFromJSONText()">üì§ –ò–º–ø–æ—Ä—Ç –∏–∑ —ç—Ç–æ–≥–æ JSON</button>
                <button onclick="uiManager.hideJSON()">–°–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>
<!-- MODULE: CORE_JS -->
<script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
    const techData = { categories: [] };
    let currentModalPath = [];
    let lastKnownRemoteSha = null;
    let lastSyncTime = null;
    let currentKnowledgeItem = null;
</script>

<!-- MODULE: UI_MANAGER -->
<script>
    const uiManager = {
        showModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        },

        showAddNodeModal(pathStr = '[]') {
            const path = JSON.parse(pathStr);
            currentModalPath = path;
            this.updateParentSelect('nodeModal', path);
            this.showModal('nodeModal');
        },

        showAddTechModal(pathStr = '[]') {
            const path = JSON.parse(pathStr);
            currentModalPath = path;
            this.updateParentSelect('techModal', path);
            this.showModal('techModal');
        },

        hideModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
        },

        hideJSON() {
            document.getElementById('jsonSection').classList.add('hidden');
        },

        updateParentSelect(modalId, currentPath) {
            const container = document.getElementById(modalId === 'nodeModal' ? 'nodeParentSelect' : 'techParentSelect');
            if (!container) return;
            
            container.innerHTML = '';
            
            const title = document.createElement('div');
            title.innerHTML = `<strong>–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> ${this.getPathDisplay(currentPath) || '–ö–æ—Ä–µ–Ω—å'}`;
            container.appendChild(title);
        },

        getPathDisplay(path) {
            if (path.length === 0) return '';
            let currentNode = techData.categories;
            let pathNames = [];
            
            for (const index of path) {
                if (currentNode[index]) {
                    pathNames.push(currentNode[index].name);
                    currentNode = currentNode[index].children || [];
                }
            }
            
            return pathNames.join(' ‚Üí ');
        },

        showNotification(message, type) {
            const oldNotifications = document.querySelectorAll('.notification');
            oldNotifications.forEach(notif => notif.remove());
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    };
</script>
<!-- MODULE: DATA_MANAGER -->
<script>
    const dataManager = {
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—É—Ç—è–º–∏
        getNodeByPath(path) {
            let currentNode = techData.categories;
            for (const index of path) {
                if (currentNode[index]) {
                    currentNode = currentNode[index].children || [];
                } else {
                    return null;
                }
            }
            return currentNode;
        },

        getNodeAtIndex(path, index) {
            const parent = this.getNodeByPath(path);
            return parent ? parent[index] : null;
        },

        // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
        saveToLocalStorage() {
            localStorage.setItem('techData', JSON.stringify(techData));
        },

        loadFromLocalStorage() {
            const saved = localStorage.getItem('techData');
            if (saved) {
                try {
                    const parsedData = JSON.parse(saved);
                    techData.categories = parsedData.categories || [];
                    this.renderCurrentView();
                } catch (e) {
                    console.error('Error parsing saved data:', e);
                }
            }
        },

        // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –≤–∏–¥–∞
        renderCurrentView() {
            accordionManager.renderAccordion();
        },

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏
        addCategory() {
            const name = document.getElementById('newCategoryName').value.trim();
            if (name) {
                techData.categories.push({
                    name: name,
                    type: 'category',
                    children: []
                });
                this.renderCurrentView();
                this.saveToLocalStorage();
                uiManager.hideModals();
                document.getElementById('newCategoryName').value = '';
                uiManager.showNotification('–ö–∞—Ç–µ–≥–æ—Ä–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!', 'success');
                
                authManager.scheduleAutoSave();
            } else {
                uiManager.showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏!', 'error');
            }
        },

        addNode() {
            const name = document.getElementById('newNodeName').value.trim();
            
            if (name && currentModalPath.length >= 0) {
                const parent = this.getNodeByPath(currentModalPath);
                if (!parent) {
                    uiManager.showNotification('–û—à–∏–±–∫–∞: —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                    return;
                }

                parent.push({
                    name: name,
                    type: 'node',
                    children: []
                });

                this.renderCurrentView();
                this.saveToLocalStorage();
                uiManager.hideModals();
                document.getElementById('newNodeName').value = '';
                uiManager.showNotification('–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!', 'success');
                
                authManager.scheduleAutoSave();
            } else {
                uiManager.showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏!', 'error');
            }
        },

        addTechnology() {
            const name = document.getElementById('newTechName').value.trim();
            
            if (name && currentModalPath.length >= 0) {
                const parent = this.getNodeByPath(currentModalPath);
                if (!parent) {
                    uiManager.showNotification('–û—à–∏–±–∫–∞: —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                    return;
                }

                const tech = {
                    name: name,
                    type: 'technology',
                    checklist: [],
                    completed: false
                };

                parent.push(tech);

                this.renderCurrentView();
                this.saveToLocalStorage();
                uiManager.hideModals();
                document.getElementById('newTechName').value = '';
                uiManager.showNotification('–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!', 'success');
                
                authManager.scheduleAutoSave();
            } else {
                uiManager.showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏!', 'error');
            }
        },

        // –§—É–Ω–∫—Ü–∏–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        editNode(pathStr, index) {
            const path = JSON.parse(pathStr);
            const node = this.getNodeAtIndex(path, index);
            if (!node) return;

            const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:', node.name);
            if (newName && newName.trim()) {
                node.name = newName.trim();
                this.renderCurrentView();
                this.saveToLocalStorage();
                uiManager.showNotification('–ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞!', 'success');
                authManager.scheduleAutoSave();
            }
        },

        editTechnology(pathStr, index) {
            const path = JSON.parse(pathStr);
            const node = this.getNodeAtIndex(path, index);
            if (!node) return;

            const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:', node.name);
            if (newName && newName.trim()) {
                node.name = newName.trim();
                this.renderCurrentView();
                this.saveToLocalStorage();
                uiManager.showNotification('–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞!', 'success');
                authManager.scheduleAutoSave();
            }
        },

        // –§—É–Ω–∫—Ü–∏–∏ —É–¥–∞–ª–µ–Ω–∏—è
        deleteNode(pathStr, index) {
            const path = JSON.parse(pathStr);
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ –≤—Å–µ –µ—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ?')) {
                const parent = this.getNodeByPath(path);
                if (parent) {
                    parent.splice(index, 1);
                    this.renderCurrentView();
                    this.saveToLocalStorage();
                    uiManager.showNotification('–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É–¥–∞–ª–µ–Ω–∞!', 'success');
                    authManager.scheduleAutoSave();
                }
            }
        },

        deleteTechnology(pathStr, index) {
            const path = JSON.parse(pathStr);
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é –∏ –≤—Å–µ –µ—ë –∑–∞–¥–∞—á–∏?')) {
                const parent = this.getNodeByPath(path);
                if (parent) {
                    parent.splice(index, 1);
                    this.renderCurrentView();
                    this.saveToLocalStorage();
                    uiManager.showNotification('–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è —É–¥–∞–ª–µ–Ω–∞!', 'success');
                    authManager.scheduleAutoSave();
                }
            }
        },

        // –†–∞–±–æ—Ç–∞ —Å JSON
        exportToJSON() {
            const jsonOutput = document.getElementById('jsonOutput');
            const jsonSection = document.getElementById('jsonSection');
            
            jsonOutput.value = JSON.stringify(techData, null, 2);
            jsonSection.classList.remove('hidden');
        },

        importFromJSON() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const parsedData = JSON.parse(e.target.result);
                        techData.categories = parsedData.categories || [];
                        dataManager.renderCurrentView();
                        dataManager.saveToLocalStorage();
                        uiManager.showNotification('–î–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!', 'success');
                        authManager.scheduleAutoSave();
                    } catch (error) {
                        uiManager.showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ JSON —Ñ–∞–π–ª–∞', 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        },

        importFromJSONText() {
            const jsonText = document.getElementById('jsonOutput').value;
            try {
                const parsedData = JSON.parse(jsonText);
                techData.categories = parsedData.categories || [];
                this.renderCurrentView();
                this.saveToLocalStorage();
                uiManager.showNotification('–î–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ JSON!', 'success');
                authManager.scheduleAutoSave();
            } catch (error) {
                uiManager.showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–∑–±–æ—Ä–µ JSON', 'error');
            }
        },

        copyToClipboard() {
            const jsonOutput = document.getElementById('jsonOutput');
            jsonOutput.select();
            document.execCommand('copy');
            uiManager.showNotification('JSON —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
        }
    };
</script>
<!-- MODULE: ACCORDION_MANAGER -->
<script>
    const accordionManager = {
        init() {
            this.accordionContainer = document.getElementById('accordion');
            this.expandedState = JSON.parse(localStorage.getItem('accordionExpandedState')) || {};
            this.checklistExpandedState = JSON.parse(localStorage.getItem('checklistExpandedState')) || {};
            this.renderAccordion();
        },

        renderAccordion() {
            if (!this.accordionContainer) {
                console.error('Accordion container not found');
                return;
            }
            
            this.accordionContainer.innerHTML = '';
            
            if (techData.categories.length === 0) {
                this.accordionContainer.innerHTML = '<p style="text-align: center; color: #6c757d;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é!</p>';
                return;
            }

            this.buildAccordion(techData.categories, this.accordionContainer, []);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è
            localStorage.setItem('accordionExpandedState', JSON.stringify(this.expandedState));
            localStorage.setItem('checklistExpandedState', JSON.stringify(this.checklistExpandedState));
        },

        buildAccordion(nodes, parentElement, path) {
            nodes.forEach((node, index) => {
                const currentPath = [...path, index];
                const pathKey = currentPath.join('-');
                
                // –ï—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –∑–∞–¥–∞–Ω–æ, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞—Å–∫—Ä—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∫–æ—Ä–Ω–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                if (this.expandedState[pathKey] === undefined) {
                    this.expandedState[pathKey] = path.length === 0;
                }
                
                const item = document.createElement('div');
                item.className = 'accordion-item';
                
                // –†–∞—Å—á–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è —É–∑–ª–∞
                const nodeProgress = this.calculateNodeProgress(node);
                const progress = nodeProgress.progress;
                const hasChecklistItems = nodeProgress.hasChecklistItems;
                
                let statusText = '';
                let statusClass = '';
                
                if (node.type === 'technology') {
                    if (!hasChecklistItems) {
                        statusText = node.completed ? '‚úÖ –ò–∑—É—á–µ–Ω–æ' : 'üìù –í –ø–ª–∞–Ω–∞—Ö';
                        statusClass = node.completed ? 'status-completed' : 'status-planned';
                    } else {
                        if (progress === 0) {
                            statusText = 'üìù –í –ø–ª–∞–Ω–∞—Ö';
                            statusClass = 'status-planned';
                        } else if (progress === 100) {
                            statusText = '‚úÖ –ò–∑—É—á–µ–Ω–æ';
                            statusClass = 'status-completed';
                        } else {
                            statusText = 'üöß –í –ø—Ä–æ—Ü–µ—Å—Å–µ';
                            statusClass = 'status-in-progress';
                        }
                    }
                } else {
                    // –î–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                    if (progress === 0) {
                        statusText = 'üìù –ù–µ –Ω–∞—á–∞—Ç–æ';
                        statusClass = 'status-planned';
                    } else if (progress === 100) {
                        statusText = '‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ';
                        statusClass = 'status-completed';
                    } else {
                        statusText = 'üöß –í –ø—Ä–æ—Ü–µ—Å—Å–µ';
                        statusClass = 'status-in-progress';
                    }
                }

                // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–∞
                const header = document.createElement('div');
                header.className = `accordion-header ${node.type === 'technology' ? 'technology' : 'category'}`;
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è/—Å–∫—Ä—ã—Ç–∏—è
                header.onclick = (e) => {
                    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
                    if (!e.target.closest('.accordion-actions') && !e.target.closest('.accordion-toggle') && 
                        !e.target.closest('.technology-checkbox')) {
                        this.toggleItem(pathKey);
                    }
                };
                
                const title = document.createElement('div');
                title.className = 'accordion-title';
                
                // –ò–∫–æ–Ω–∫–∞ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π/—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
                const icon = document.createElement('span');
                icon.className = 'accordion-icon';
                icon.textContent = node.type === 'technology' ? '‚öôÔ∏è' : 'üìÅ';
                title.appendChild(icon);
                
                // –ù–∞–∑–≤–∞–Ω–∏–µ
                const name = document.createElement('span');
                name.textContent = node.name;
                name.style.fontWeight = 'bold';
                title.appendChild(name);

                // –ë–µ–π–¥–∂ –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
                if (node.content && node.content.length > 0) {
                    const badge = document.createElement('span');
                    badge.className = 'knowledge-badge';
                    badge.textContent = 'üìö';
                    badge.title = '–ï—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π';
                    title.appendChild(badge);
                }
                
                header.appendChild(title);
                
                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å
                const stats = document.createElement('div');
                stats.className = 'accordion-stats';
                
                const status = document.createElement('span');
                status.className = statusClass;
                status.textContent = statusText;
                stats.appendChild(status);
                
                const progressContainer = document.createElement('div');
                progressContainer.className = 'accordion-progress';
                
                const progressBar = document.createElement('div');
                progressBar.className = 'progress-bar';
                progressBar.style.width = '100px';
                const progressFill = document.createElement('div');
                progressFill.className = 'progress-fill';
                progressFill.style.width = `${progress}%`;
                progressBar.appendChild(progressFill);
                progressContainer.appendChild(progressBar);
                
                const progressText = document.createElement('span');
                progressText.textContent = `${Math.round(progress)}%`;
                progressText.style.fontSize = '0.9em';
                progressText.style.color = '#6c757d';
                progressContainer.appendChild(progressText);
                
                stats.appendChild(progressContainer);
                
                // –ß–µ–∫–±–æ–∫—Å –¥–ª—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –±–µ–∑ —á–µ–∫-–ª–∏—Å—Ç–∞
                if (node.type === 'technology' && (!node.checklist || node.checklist.length === 0)) {
                    const checkboxContainer = document.createElement('div');
                    checkboxContainer.className = 'technology-checkbox';
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.checked = node.completed || false;
                    checkbox.onchange = (e) => {
                        node.completed = e.target.checked;
                        dataManager.saveToLocalStorage();
                        authManager.scheduleAutoSave();
                        this.renderAccordion();
                    };
                    checkboxContainer.appendChild(checkbox);
                    const label = document.createElement('span');
                    label.textContent = '–ò–∑—É—á–µ–Ω–æ';
                    label.style.fontSize = '0.9em';
                    checkboxContainer.appendChild(label);
                    stats.appendChild(checkboxContainer);
                }
                
                header.appendChild(stats);
                
                // –î–µ–π—Å—Ç–≤–∏—è
                const actions = document.createElement('div');
                actions.className = 'accordion-actions';
                
                if (node.type === 'technology') {
                    actions.innerHTML = `
                        <button onclick="knowledgeManager.openKnowledgeBase('${JSON.stringify(path)}', ${index})" title="–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π" style="background: #9c27b0;">üìö</button>
                        <button onclick="dataManager.editTechnology('${JSON.stringify(path)}', ${index})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
                        <button class="delete" onclick="dataManager.deleteTechnology('${JSON.stringify(path)}', ${index})" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                    `;
                } else {
                    actions.innerHTML = `
                        <button onclick="uiManager.showAddNodeModal('${JSON.stringify(currentPath)}')" title="–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é">+ üìÅ</button>
                        <button onclick="uiManager.showAddTechModal('${JSON.stringify(currentPath)}')" title="–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é">+ ‚öôÔ∏è</button>
                        <button onclick="dataManager.editNode('${JSON.stringify(path)}', ${index})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
                        <button class="delete" onclick="dataManager.deleteNode('${JSON.stringify(path)}', ${index})" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                    `;
                }
                
                header.appendChild(actions);
                
                // –ö–Ω–æ–ø–∫–∞ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                if (node.children && node.children.length > 0) {
                    const toggle = document.createElement('button');
                    toggle.className = 'accordion-toggle';
                    toggle.innerHTML = this.expandedState[pathKey] ? '‚ñº' : '‚ñ∫';
                    toggle.onclick = (e) => {
                        e.stopPropagation();
                        this.toggleItem(pathKey);
                    };
                    header.appendChild(toggle);
                }
                
                item.appendChild(header);
                
                // –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–∞ (–¥–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã)
                if (node.children && node.children.length > 0) {
                    const content = document.createElement('div');
                    content.className = 'accordion-content';
                    if (this.expandedState[pathKey]) {
                        content.classList.add('expanded');
                    }
                    
                    const childContainer = document.createElement('div');
                    childContainer.className = 'accordion-child';
                    this.buildAccordion(node.children, childContainer, currentPath);
                    content.appendChild(childContainer);
                    
                    item.appendChild(content);
                }
                
                parentElement.appendChild(item);
            });
        },
        
        toggleItem(pathKey) {
            this.expandedState[pathKey] = !this.expandedState[pathKey];
            this.renderAccordion();
        },
        
        // –†–∞—Å—á–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è —É–∑–ª–∞ (—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π)
        calculateNodeProgress(node) {
            if (node.type === 'technology') {
                // –î–ª—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
                if (node.checklist && node.checklist.length > 0) {
                    // –ï—Å–ª–∏ –µ—Å—Ç—å —á–µ–∫-–ª–∏—Å—Ç, —Å—á–∏—Ç–∞–µ–º –ø–æ –Ω–µ–º—É
                    const completed = node.checklist.filter(item => item.completed).length;
                    const total = node.checklist.length;
                    const progress = total > 0 ? (completed / total) * 100 : 0;
                    return { progress, hasChecklistItems: true };
                } else {
                    // –ï—Å–ª–∏ –Ω–µ—Ç —á–µ–∫-–ª–∏—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–µ completed
                    const progress = node.completed ? 100 : 0;
                    return { progress, hasChecklistItems: false };
                }
            } else {
                // –î–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ - —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ —Å—á–∏—Ç–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –≤—Å–µ—Ö –¥–µ—Ç–µ–π
                if (!node.children || node.children.length === 0) {
                    return { progress: 0, hasChecklistItems: false };
                }
                
                let totalProgress = 0;
                let childCount = 0;
                let hasChecklistItems = false;
                
                node.children.forEach(child => {
                    const childProgress = this.calculateNodeProgress(child);
                    totalProgress += childProgress.progress;
                    childCount++;
                    if (childProgress.hasChecklistItems) {
                        hasChecklistItems = true;
                    }
                });
                
                const progress = childCount > 0 ? totalProgress / childCount : 0;
                return { progress, hasChecklistItems };
            }
        }
    };
</script>
<!-- MODULE: AUTH_MANAGER -->
<script>
    const authManager = {
        autoSaveEnabled: false,
        autoSaveInterval: null,
        lastSaveTime: null,
        autoSaveTimeout: null,

        // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π
        async testAuth() {
            const token = document.getElementById('githubToken').value;
            const owner = document.getElementById('repoOwner').value;
            const repo = document.getElementById('repoName').value;
            
            if (!token || !owner || !repo) {
                this.showAuthStatus('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!', 'error');
                return;
            }

            try {
                this.showAuthStatus('–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...', 'warning');
                
                const response = await fetch(`https://api.github.com/repos/${owner}/${repo}`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'User-Agent': 'TechDocs-App'
                    }
                });

                const responseData = await response.json();

                if (response.status === 200) {
                    const permissions = responseData.permissions;
                    if (permissions && permissions.push) {
                        this.showAuthStatus('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ! –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∑–∞–ø–∏—Å–∏.', 'success');
                        this.enableAutoSave();
                    } else {
                        this.showAuthStatus('‚ö†Ô∏è –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–æ—Å—Ç—É–ø–µ–Ω, –Ω–æ –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∑–∞–ø–∏—Å—å.', 'warning');
                    }
                } else if (response.status === 404) {
                    this.showAuthStatus('‚ùå –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è –∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞.', 'error');
                } else if (response.status === 401) {
                    this.showAuthStatus('‚ùå –û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω.', 'error');
                } else if (response.status === 403) {
                    this.showAuthStatus('üö´ –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ repo.', 'error');
                } else {
                    this.showAuthStatus(`‚ùå –û—à–∏–±–∫–∞: ${response.status} - ${responseData.message || response.statusText}`, 'error');
                }
            } catch (error) {
                console.error('Auth test error:', error);
                this.showAuthStatus('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message, 'error');
            }
        },

        saveAuth() {
            const token = document.getElementById('githubToken').value;
            const owner = document.getElementById('repoOwner').value;
            const repo = document.getElementById('repoName').value;
            
            if (token && owner && repo) {
                localStorage.setItem('githubToken', token);
                localStorage.setItem('repoOwner', owner);
                localStorage.setItem('repoName', repo);
                uiManager.showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
                setTimeout(() => this.testAuth(), 500);
            } else {
                uiManager.showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!', 'error');
            }
        },

        loadAuth() {
            const token = localStorage.getItem('githubToken');
            const owner = localStorage.getItem('repoOwner');
            const repo = localStorage.getItem('repoName');
            
            if (token) document.getElementById('githubToken').value = token;
            if (owner) document.getElementById('repoOwner').value = owner;
            if (repo) document.getElementById('repoName').value = repo;
            
            if (token && owner && repo) {
                setTimeout(() => this.testAuth(), 1000);
            }
        },

        showAuthStatus(message, type) {
            const authStatus = document.getElementById('authStatus');
            if (!authStatus) return;
            
            authStatus.textContent = message;
            authStatus.className = 'auth-status';
            authStatus.classList.add(type === 'success' ? 'auth-success' : 
                                   type === 'warning' ? 'auth-warning' : 'auth-error');
            authStatus.style.display = 'block';
        },

        // –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
        enableAutoSave() {
            if (this.autoSaveEnabled) return;
            
            this.autoSaveEnabled = true;
            this.updateAutoSaveButton();
            
            this.autoSaveInterval = setInterval(() => {
                this.autoSaveToGitHub();
            }, 2 * 60 * 1000);
            
            window.addEventListener('beforeunload', this.autoSaveToGitHub.bind(this));
            
            uiManager.showNotification('üîÑ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ (–∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã)', 'success');
        },
        
        disableAutoSave() {
            if (this.autoSaveInterval) {
                clearInterval(this.autoSaveInterval);
                this.autoSaveInterval = null;
            }
            this.autoSaveEnabled = false;
            this.updateAutoSaveButton();
            window.removeEventListener('beforeunload', this.autoSaveToGitHub.bind(this));
            uiManager.showNotification('‚è∏Ô∏è –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ', 'warning');
        },
        
        toggleAutoSave() {
            if (this.autoSaveEnabled) {
                this.disableAutoSave();
            } else {
                this.enableAutoSave();
            }
        },
        
        updateAutoSaveButton() {
            const button = document.getElementById('autoSaveBtn');
            if (!button) return;
            
            if (this.autoSaveEnabled) {
                button.innerHTML = '‚úÖ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ';
                button.className = 'auto-save-enabled';
            } else {
                button.innerHTML = 'üö´ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ';
                button.className = 'auto-save-disabled';
            }
        },

        // –†–∞–±–æ—Ç–∞ —Å GitHub API
        async loadFromGitHub() {
            const token = localStorage.getItem('githubToken');
            const owner = localStorage.getItem('repoOwner');
            const repo = localStorage.getItem('repoName');
            
            if (!token || !owner || !repo) {
                uiManager.showNotification('–°–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ—Å—Ç—É–ø –∫ GitHub!', 'error');
                return;
            }

            try {
                uiManager.showNotification('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å GitHub...', 'warning');
                
                const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/tech-data.json`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'User-Agent': 'TechDocs-App'
                    }
                });

                if (response.status === 200) {
                    const data = await response.json();
                    const content = decodeURIComponent(escape(atob(data.content)));
                    const parsedData = JSON.parse(content);
                    
                    techData.categories = parsedData.categories || [];
                    dataManager.renderCurrentView();
                    dataManager.saveToLocalStorage();
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
                    lastKnownRemoteSha = data.sha;
                    lastSyncTime = Date.now();
                    this.updateSyncStatus();
                    
                    uiManager.showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å GitHub!', 'success');
                } else if (response.status === 404) {
                    uiManager.showNotification('üìù –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª.', 'warning');
                    techData.categories = [];
                    dataManager.renderCurrentView();
                    dataManager.saveToLocalStorage();
                } else {
                    const errorData = await response.json();
                    throw new Error(`GitHub API error: ${response.status} - ${errorData.message || response.statusText}`);
                }
            } catch (error) {
                console.error('GitHub load error:', error);
                uiManager.showNotification('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message, 'error');
            }
        },

        async saveToGitHub() {
            const token = localStorage.getItem('githubToken');
            const owner = localStorage.getItem('repoOwner');
            const repo = localStorage.getItem('repoName');
            
            if (!token || !owner || !repo) {
                uiManager.showNotification('–°–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ—Å—Ç—É–ø –∫ GitHub!', 'error');
                return;
            }

            try {
                uiManager.showNotification('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ GitHub...', 'warning');
                
                if (!techData || techData.categories.length === 0) {
                    uiManager.showNotification('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!', 'error');
                    return;
                }

                let sha = null;
                
                try {
                    const getResponse = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/tech-data.json`, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'User-Agent': 'TechDocs-App'
                        }
                    });
                    
                    if (getResponse.status === 200) {
                        const data = await getResponse.json();
                        sha = data.sha;
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ñ–∞–π–ª–∞:', e);
                }

                const content = JSON.stringify(techData, null, 2);
                const contentBase64 = btoa(unescape(encodeURIComponent(content)));
                const message = `Update tech data: ${new Date().toLocaleString()}`;
                
                const requestBody = {
                    message: message,
                    content: contentBase64
                };

                if (sha) {
                    requestBody.sha = sha;
                }

                const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/tech-data.json`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json',
                        'User-Agent': 'TechDocs-App'
                    },
                    body: JSON.stringify(requestBody)
                });

                const responseData = await response.json();

                if (response.status === 200 || response.status === 201) {
                    lastSyncTime = Date.now();
                    this.updateSyncStatus();
                    uiManager.showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –Ω–∞ GitHub!', 'success');
                } else {
                    let errorMessage = `–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${response.status}`;
                    if (responseData && responseData.message) {
                        errorMessage += ` - ${responseData.message}`;
                    }
                    throw new Error(errorMessage);
                }
            } catch (error) {
                console.error('GitHub save error:', error);
                uiManager.showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message, 'error');
            }
        },

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
        scheduleAutoSave() {
            if (!this.autoSaveEnabled) return;
            
            if (this.autoSaveTimeout) {
                clearTimeout(this.autoSaveTimeout);
            }
            
            this.autoSaveTimeout = setTimeout(() => {
                this.autoSaveToGitHub();
            }, 10000);
        },

        updateSyncStatus() {
            const syncStatus = document.getElementById('syncStatus');
            if (!syncStatus) return;
            
            if (lastSyncTime) {
                const lastSync = new Date(lastSyncTime).toLocaleString();
                syncStatus.innerHTML = `üîÑ –ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: ${lastSync}`;
            } else {
                syncStatus.innerHTML = '‚è≥ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª–∞—Å—å';
            }
        },

        async autoSaveToGitHub() {
            // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞
            if (this.autoSaveEnabled) {
                await this.saveToGitHub();
            }
        }
    };
</script>
<!-- MODULE: KNOWLEDGE_MANAGER -->
<script>
    const knowledgeManager = {
        currentItem: null,
        
        // –û—Ç–∫—Ä—ã—Ç–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞
        openKnowledgeBase(pathStr, index) {
            const path = JSON.parse(pathStr);
            const item = dataManager.getNodeAtIndex(path, index);
            
            if (!item) {
                uiManager.showNotification('–≠–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                return;
            }
            
            this.currentItem = item;
            currentKnowledgeItem = item;
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–ª–µ content, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
            if (!item.content) {
                item.content = '';
            }
            
            document.getElementById('knowledgeTitle').textContent = `–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π: ${item.name}`;
            document.getElementById('knowledgeEditor').innerHTML = item.content || '';
            this.renderPreview();
            
            uiManager.showModal('knowledgeModal');
        },
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏
        switchTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
            document.querySelectorAll('.content-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(`${tabName}Tab`).classList.add('active');
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.content-tab').forEach(tab => {
                if (tab.textContent.includes(this.getTabIcon(tabName))) {
                    tab.classList.add('active');
                }
            });
            
            // –ï—Å–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä, –æ–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é
            if (tabName === 'preview') {
                this.renderPreview();
            }
        },
        
        getTabIcon(tabName) {
            const icons = {
                'editor': '‚úèÔ∏è',
                'preview': 'üëÅÔ∏è',
                'media': 'üñºÔ∏è',
                'links': 'üîó'
            };
            return icons[tabName] || '';
        },
        
        // –†–µ–Ω–¥–µ—Ä –ø—Ä–µ–≤—å—é –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        renderPreview() {
            const content = document.getElementById('knowledgeEditor').innerHTML;
            document.getElementById('knowledgePreview').innerHTML = content;
        },
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        saveContent() {
            if (!this.currentItem) return;
            
            this.currentItem.content = document.getElementById('knowledgeEditor').innerHTML;
            this.scheduleSave();
            uiManager.showNotification('–ö–æ–Ω—Ç–µ–Ω—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');
        },
        
        // –≠–∫—Å–ø–æ—Ä—Ç –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        exportContent() {
            const content = this.currentItem.content;
            const blob = new Blob([content], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${this.currentItem.name}.html`;
            a.click();
            URL.revokeObjectURL(url);
        },
        
        // –ò–º–ø–æ—Ä—Ç –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        importContent() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.html,.txt';
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('knowledgeEditor').innerHTML = e.target.result;
                    this.renderPreview();
                    uiManager.showNotification('–ö–æ–Ω—Ç–µ–Ω—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω!', 'success');
                };
                reader.readAsText(file);
            };
            input.click();
        },
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫
        showGlobalSearch() {
            uiManager.showModal('searchModal');
            document.getElementById('globalSearch').focus();
        },
        
        // –ü–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
        performSearch() {
            const query = document.getElementById('globalSearch').value.toLowerCase();
            const results = document.getElementById('searchResults');
            results.innerHTML = '';
            
            if (!query) {
                results.innerHTML = '<p style="text-align: center; color: #6c757d;">–í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å</p>';
                return;
            }
            
            const searchResults = this.searchInKnowledgeBase(query);
            
            if (searchResults.length === 0) {
                results.innerHTML = '<p style="text-align: center; color: #6c757d;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>';
                return;
            }
            
            searchResults.forEach(result => {
                const resultItem = document.createElement('div');
                resultItem.className = 'search-result-item';
                resultItem.style.padding = '10px';
                resultItem.style.borderBottom = '1px solid #e9ecef';
                resultItem.style.cursor = 'pointer';
                
                resultItem.innerHTML = `
                    <div style="font-weight: bold;">${result.item.name}</div>
                    <div style="font-size: 0.9em; color: #6c757d;">${result.context}</div>
                `;
                
                resultItem.onclick = () => {
                    this.openKnowledgeBase(JSON.stringify(result.path), result.index);
                    uiManager.hideModals();
                };
                
                results.appendChild(resultItem);
            });
        },
        
        // –ü–æ–∏—Å–∫ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
        searchInKnowledgeBase(query) {
            const results = [];
            
            function searchInNodes(nodes, path = []) {
                nodes.forEach((node, index) => {
                    // –ü–æ–∏—Å–∫ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏
                    if (node.name.toLowerCase().includes(query)) {
                        results.push({
                            item: node,
                            path: [...path],
                            index: index,
                            context: `–ù–∞–∑–≤–∞–Ω–∏–µ: ${node.name}`
                        });
                    }
                    
                    // –ü–æ–∏—Å–∫ –≤ –∫–æ–Ω—Ç–µ–Ω—Ç–µ
                    if (node.content && node.content.toLowerCase().includes(query)) {
                        const contentPreview = node.content.replace(/<[^>]*>/g, '').substring(0, 100) + '...';
                        results.push({
                            item: node,
                            path: [...path],
                            index: index,
                            context: `–ö–æ–Ω—Ç–µ–Ω—Ç: ${contentPreview}`
                        });
                    }
                    
                    // –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫ –≤ –¥–µ—Ç—è—Ö
                    if (node.children) {
                        searchInNodes(node.children, [...path, index]);
                    }
                });
            }
            
            searchInNodes(techData.categories);
            return results;
        },
        
        // –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        scheduleSave() {
            dataManager.saveToLocalStorage();
            authManager.scheduleAutoSave();
            accordionManager.renderAccordion();
        }
    };
</script>

<!-- MODULE: KNOWLEDGE_EDITOR -->
<script>
    const knowledgeEditor = {
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
        formatText(command, value = null) {
            document.execCommand(command, false, value);
            document.getElementById('knowledgeEditor').focus();
        },
        
        // –í—Å—Ç–∞–≤–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞
        insertHeading(level) {
            this.formatText('formatBlock', `<h${level}>`);
        },
        
        // –í—Å—Ç–∞–≤–∫–∞ —Å–ø–∏—Å–∫–∞
        insertList(type) {
            this.formatText(type === 'ul' ? 'insertUnorderedList' : 'insertOrderedList');
        },
        
        // –í—Å—Ç–∞–≤–∫–∞ —Å—Å—ã–ª–∫–∏
        insertLink() {
            const url = prompt('–í–≤–µ–¥–∏—Ç–µ URL:');
            if (url) {
                this.formatText('createLink', url);
            }
        },
        
        // –í—Å—Ç–∞–≤–∫–∞ –∫–æ–¥–∞
        insertCode() {
            const code = prompt('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥:');
            if (code) {
                this.insertHtml(`<pre><code>${code}</code></pre>`);
            }
        },
        
        // –í—Å—Ç–∞–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã
        insertTable() {
            const rows = parseInt(prompt('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫:', '3')) || 3;
            const cols = parseInt(prompt('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–æ–ª–±—Ü–æ–≤:', '3')) || 3;
            
            let tableHtml = '<table style="width: 100%; border-collapse: collapse;">';
            
            for (let i = 0; i < rows; i++) {
                tableHtml += '<tr>';
                for (let j = 0; j < cols; j++) {
                    tableHtml += `<td style="border: 1px solid #ddd; padding: 8px;">&nbsp;</td>`;
                }
                tableHtml += '</tr>';
            }
            
            tableHtml += '</table>';
            this.insertHtml(tableHtml);
        },
        
        // –í—Å—Ç–∞–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        insertImage() {
            const url = prompt('–í–≤–µ–¥–∏—Ç–µ URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:');
            if (url) {
                this.insertHtml(`<img src="${url}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" style="max-width: 100%;">`);
            }
        },
        
        // –í—Å—Ç–∞–≤–∫–∞ –≤–∏–¥–µ–æ
        insertVideo() {
            const url = prompt('–í–≤–µ–¥–∏—Ç–µ URL –≤–∏–¥–µ–æ:');
            if (url) {
                this.insertHtml(`<video controls style="max-width: 100%;"><source src="${url}"></video>`);
            }
        },
        
        // –í—Å—Ç–∞–≤–∫–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å—Å—ã–ª–∫–∏
        insertInternalLink() {
            const techName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:');
            if (techName) {
                this.insertHtml(`<a href="#" class="internal-link" data-target="${techName}">${techName}</a>`);
            }
        },
        
        // –í—Å—Ç–∞–≤–∫–∞ HTML
        insertHtml(html) {
            const editor = document.getElementById('knowledgeEditor');
            const selection = window.getSelection();
            
            if (selection.rangeCount) {
                const range = selection.getRangeAt(0);
                range.deleteContents();
                
                const div = document.createElement('div');
                div.innerHTML = html;
                const fragment = document.createDocumentFragment();
                
                while (div.firstChild) {
                    fragment.appendChild(div.firstChild);
                }
                
                range.insertNode(fragment);
            } else {
                editor.innerHTML += html;
            }
            
            editor.focus();
        }
    };
</script>
<!-- MODULE: CHECKLIST_MANAGER -->
<script>
    const checklistManager = {
        currentChecklist: {
            path: [],
            techIndex: -1
        },

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ–∫-–ª–∏—Å—Ç–∞–º–∏
        manageChecklist(pathStr, techIndex) {
            const path = JSON.parse(pathStr);
            this.currentChecklist = {
                path,
                techIndex
            };
            
            const tech = this.getTechnology();
            if (!tech) return;
            
            if (!tech.checklist) {
                tech.checklist = [];
            }
            
            this.renderChecklist();
            uiManager.showModal('checklistModal');
        },
        
        renderChecklist() {
            const tech = this.getTechnology();
            if (!tech) return;
            
            const checklistItems = document.getElementById('checklistItems');
            const checklistStats = document.getElementById('checklistStats');
            
            if (!checklistItems || !checklistStats) return;
            
            checklistItems.innerHTML = '';
            
            if (tech.checklist && tech.checklist.length > 0) {
                tech.checklist.forEach((item, index) => {
                    const itemElement = document.createElement('div');
                    itemElement.className = `checklist-item ${item.completed ? 'completed' : ''}`;
                    itemElement.innerHTML = `
                        <input type="checkbox" ${item.completed ? 'checked' : ''} 
                               onchange="checklistManager.toggleChecklistItem('${JSON.stringify(this.currentChecklist.path)}', ${this.currentChecklist.techIndex}, ${index})">
                        <span class="checklist-item-text">${item.text}</span>
                        <button onclick="checklistManager.removeChecklistItem(${index})" class="delete" style="margin-left: 10px;">üóëÔ∏è</button>
                        <button onclick="checklistManager.editChecklistItem(${index})" style="margin-left: 5px;">‚úèÔ∏è</button>
                    `;
                    checklistItems.appendChild(itemElement);
                });
            } else {
                checklistItems.innerHTML = '<p style="text-align: center; color: #6c757d;">–ß–µ–∫-–ª–∏—Å—Ç –ø—É—Å—Ç. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π –ø—É–Ω–∫—Ç!</p>';
            }
            
            const completed = tech.checklist ? tech.checklist.filter(item => item.completed).length : 0;
            const total = tech.checklist ? tech.checklist.length : 0;
            const progress = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            checklistStats.innerHTML = `
                –ü—Ä–æ–≥—Ä–µ—Å—Å: ${completed}/${total} (${progress}%)
                <div class="progress-bar" style="width: 100%; margin-top: 5px;">
                    <div class="progress-fill" style="width: ${progress}%"></div>
                </div>
            `;
        },
        
        addChecklistItem() {
            const input = document.getElementById('newChecklistItem');
            if (!input) return;
            
            const text = input.value.trim();
            
            if (text) {
                const tech = this.getTechnology();
                if (!tech) return;
                
                if (!tech.checklist) {
                    tech.checklist = [];
                }
                
                tech.checklist.push({
                    text: text,
                    completed: false
                });
                
                input.value = '';
                this.renderChecklist();
                dataManager.saveToLocalStorage();
                authManager.scheduleAutoSave();
                dataManager.renderCurrentView();
            }
        },
        
        removeChecklistItem(index) {
            const tech = this.getTechnology();
            if (!tech) return;
            
            if (tech.checklist && tech.checklist.length > index) {
                tech.checklist.splice(index, 1);
                this.renderChecklist();
                dataManager.saveToLocalStorage();
                authManager.scheduleAutoSave();
                dataManager.renderCurrentView();
            }
        },
        
        editChecklistItem(index) {
            const tech = this.getTechnology();
            if (!tech) return;
            
            if (tech.checklist && tech.checklist.length > index) {
                const newText = prompt('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—É–Ω–∫—Ç:', tech.checklist[index].text);
                if (newText !== null) {
                    tech.checklist[index].text = newText.trim();
                    this.renderChecklist();
                    dataManager.saveToLocalStorage();
                    authManager.scheduleAutoSave();
                    dataManager.renderCurrentView();
                }
            }
        },
        
        toggleChecklistItem(pathStr, techIndex, itemIndex) {
            const path = JSON.parse(pathStr);
            this.currentChecklist = { path, techIndex };
            const tech = this.getTechnology();
            if (!tech) return;
            
            if (tech.checklist && tech.checklist.length > itemIndex) {
                tech.checklist[itemIndex].completed = !tech.checklist[itemIndex].completed;
                dataManager.saveToLocalStorage();
                authManager.scheduleAutoSave();
                dataManager.renderCurrentView();
            }
        },
        
        saveChecklist() {
            uiManager.hideModals();
            dataManager.saveToLocalStorage();
            uiManager.showNotification('–ß–µ–∫-–ª–∏—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');
            authManager.scheduleAutoSave();
            dataManager.renderCurrentView();
        },
        
        getTechnology() {
            const parent = dataManager.getNodeByPath(this.currentChecklist.path);
            return parent ? parent[this.currentChecklist.techIndex] : null;
        }
    };
</script>

<!-- MODULE: INITIALIZATION -->
<script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    document.addEventListener('DOMContentLoaded', function() {
        authManager.loadAuth();
        dataManager.loadFromLocalStorage();
        accordionManager.init();
        authManager.updateSyncStatus();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        initEventHandlers();
    });

    function initEventHandlers() {
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                uiManager.hideModals();
            }
        };

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞
        const globalSearch = document.getElementById('globalSearch');
        if (globalSearch) {
            globalSearch.addEventListener('input', () => {
                knowledgeManager.performSearch();
            });
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤ –∞–∫–∫–æ—Ä–¥–µ–æ–Ω–µ, –µ—Å–ª–∏ –æ–Ω–∏ –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã
        setTimeout(() => {
            document.querySelectorAll('.accordion-header').forEach(header => {
                header.addEventListener('click', function(e) {
                    if (!e.target.closest('.accordion-actions')) {
                        const pathKey = this.getAttribute('data-path');
                        if (pathKey) {
                            accordionManager.toggleItem(pathKey);
                        }
                    }
                });
            });
        }, 100);
    }

    // –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ knowledgeManager
    Object.assign(knowledgeManager, {
        handleFiles: function(files) {
            // –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤
            console.log('Files to handle:', files);
            uiManager.showNotification(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${files.length} —Ñ–∞–π–ª–æ–≤`, 'success');
        },
        
        filterLinks: function() {
            // –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å—Å—ã–ª–æ–∫
            const query = document.getElementById('linkSearch').value.toLowerCase();
            const linkItems = document.querySelectorAll('.link-item');
            
            linkItems.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(query) ? 'flex' : 'none';
            });
        }
    });

    // –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ authManager
    Object.assign(authManager, {
        async autoSaveToGitHub() {
            const token = localStorage.getItem('githubToken');
            const owner = localStorage.getItem('repoOwner');
            const repo = localStorage.getItem('repoName');
            
            if (!token || !owner || !repo || !this.autoSaveEnabled) {
                return;
            }

            try {
                console.log('üîÑ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ GitHub...');
                
                const content = JSON.stringify(techData, null, 2);
                const contentBase64 = btoa(unescape(encodeURIComponent(content)));
                const message = `Auto-save: ${new Date().toLocaleString()}`;
                
                const requestBody = {
                    message: message,
                    content: contentBase64
                };

                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π SHA —Ñ–∞–π–ª–∞
                try {
                    const getResponse = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/tech-data.json`, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'User-Agent': 'TechDocs-App'
                        }
                    });
                    
                    if (getResponse.status === 200) {
                        const data = await getResponse.json();
                        requestBody.sha = data.sha;
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ñ–∞–π–ª–∞ –¥–ª—è –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', e);
                }

                const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/tech-data.json`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json',
                        'User-Agent': 'TechDocs-App'
                    },
                    body: JSON.stringify(requestBody)
                });

                if (response.status === 200 || response.status === 201) {
                    this.lastSaveTime = Date.now();
                    lastSyncTime = Date.now();
                    this.updateSyncStatus();
                    console.log('‚úÖ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ');
                } else {
                    console.warn('‚ö†Ô∏è –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å:', response.status);
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
            }
        },

        async forceSync() {
            if (confirm('–≠—Ç–æ –∑–∞–≥—Ä—É–∑–∏—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é —Å GitHub. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                await this.loadFromGitHub();
            }
        }
    });
</script>
</body>
</html>
