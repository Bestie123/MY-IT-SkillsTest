<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Technologies Documentation - Tree View</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .auth-section {
            background: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 1px solid #ffeaa7;
        }

        .auth-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            display: none;
        }

        .auth-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .auth-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .controls {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .tree-container {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 5px;
            min-height: 500px;
            overflow: auto;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin: 2px;
        }

        button:hover {
            background: #0056b3;
        }

        button.delete {
            background: #dc3545;
        }

        button.delete:hover {
            background: #c82333;
        }

        button.success {
            background: #28a745;
        }

        button.success:hover {
            background: #218838;
        }

        button.warning {
            background: #ffc107;
            color: black;
        }

        button.warning:hover {
            background: #e0a800;
        }

        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 5px 0;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .hidden {
            display: none;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px;
            border-radius: 5px;
            color: white;
            z-index: 1001;
        }

        .success { background: #28a745; }
        .error { background: #dc3545; }
        .warning { background: #ffc107; color: black; }

        .checklist-section {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .checklist-item:last-child {
            border-bottom: none;
        }

        .checklist-item input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }

        .checklist-item-text {
            flex-grow: 1;
        }

        .checklist-item.completed .checklist-item-text {
            text-decoration: line-through;
            color: #6c757d;
        }

        .checklist-stats {
            margin-top: 10px;
            padding: 8px;
            background: #e9ecef;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .checklist-actions {
            margin-top: 10px;
        }

        .checklist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .checklist-title {
            font-weight: bold;
            font-size: 1.1em;
        }

        button.auto-save-enabled {
            background: #28a745;
        }

        button.auto-save-enabled:hover {
            background: #218838;
        }

        button.auto-save-disabled {
            background: #6c757d;
        }

        button.auto-save-disabled:hover {
            background: #5a6268;
        }

        .auto-save-status {
            display: inline-block;
            margin-left: 10px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
        }

        .auto-save-on {
            background: #d4edda;
            color: #155724;
        }

        .auto-save-off {
            background: #f8d7da;
            color: #721c24;
        }

        .path-display {
            font-size: 0.8em;
            color: #6c757d;
            margin-left: 10px;
            font-style: italic;
        }

        .parent-select-item {
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            background: #f8f9fa;
        }

        .parent-select-item:hover {
            background: #e9ecef;
        }

        .parent-select-item.selected {
            background: #007bff;
            color: white;
            border-color: #0056b3;
        }

        /* Tree Styles */
        .tree {
            position: relative;
            padding: 20px;
        }

        .tree ul {
            padding-left: 0;
            position: relative;
            transition: all 0.5s;
            -webkit-padding-start: 0;
        }

        .tree li {
            list-style-type: none;
            margin: 10px;
            position: relative;
            padding: 20px 5px 0 5px;
        }

        .tree li::before, .tree li::after {
            content: '';
            position: absolute;
            top: 0;
            right: 50%;
            border-top: 2px solid #3498db;
            width: 50%;
            height: 20px;
        }

        .tree li::after {
            right: auto;
            left: 50%;
            border-left: 2px solid #3498db;
        }

        .tree li:only-child::after, .tree li:only-child::before {
            display: none;
        }

        .tree li:only-child {
            padding-top: 0;
        }

        .tree li:first-child::before, .tree li:last-child::after {
            border: 0 none;
        }

        .tree li:last-child::before {
            border-right: 2px solid #3498db;
            border-radius: 0 5px 0 0;
        }

        .tree li:first-child::after {
            border-radius: 5px 0 0 0;
        }

        .tree ul ul::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            border-left: 2px solid #3498db;
            width: 0;
            height: 20px;
        }

        .tree .tree-node {
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
            background: white;
            display: inline-block;
            position: relative;
            transition: all 0.5s;
            min-width: 200px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .tree .tree-node:hover {
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transform: translateY(-2px);
        }

        .tree .tree-node.category {
            background: #e3f2fd;
            border-color: #2196f3;
        }

        .tree .tree-node.technology {
            background: #e8f5e9;
            border-color: #4caf50;
        }

        .tree .tree-node .node-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .tree .tree-node .node-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .tree .tree-node .node-actions {
            display: flex;
            gap: 2px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tree .tree-node .node-actions button {
            padding: 2px 6px;
            font-size: 0.8em;
            margin: 1px;
        }

        .tree .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
            margin: 5px 0;
        }

        .tree .progress-fill {
            height: 100%;
            background-color: #20c997;
            transition: width 0.3s ease;
        }

        .tree .status-planned { color: #6c757d; }
        .tree .status-in-progress { color: #fd7e14; }
        .tree .status-completed { color: #198754; }

        .tree .checklist-indicator {
            font-size: 0.8em;
            color: #6c757d;
            margin-top: 2px;
        }

        .tree .connector {
            position: absolute;
            background: #ccc;
            z-index: -1;
        }

        .tree .horizontal-connector {
            height: 2px;
            top: 0;
        }

        .tree .vertical-connector {
            width: 2px;
            left: 50%;
            transform: translateX(-50%);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üå≥ Technologies Documentation - Tree View</h1>
        
        <!-- –°–µ–∫—Ü–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
        <div class="auth-section" id="authSection">
            <h3>üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ GitHub</h3>
            <div>
                <input type="password" id="githubToken" placeholder="GitHub Personal Access Token" style="width: 300px;">
                <input type="text" id="repoOwner" placeholder="–í–ª–∞–¥–µ–ª–µ—Ü —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è" style="width: 150px;">
                <input type="text" id="repoName" placeholder="–ò–º—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è" style="width: 150px;">
                <button onclick="authManager.saveAuth()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                <button onclick="authManager.testAuth()" class="success">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</button>
            </div>
            <div id="authStatus" class="auth-status"></div>
            <p><small>–¢–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ. –°–æ–∑–¥–∞–π—Ç–µ —Ç–æ–∫–µ–Ω –≤ GitHub —Å –ø—Ä–∞–≤–∞–º–∏ repo</small></p>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã -->
        <div class="controls">
            <button onclick="uiManager.showModal('categoryModal')">+ –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
            <button onclick="uiManager.showAddNodeModal()">+ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
            <button onclick="uiManager.showAddTechModal()">+ –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é</button>
            <button onclick="authManager.loadFromGitHub()">üîÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å GitHub</button>
            <button onclick="authManager.saveToGitHub()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞ GitHub</button>
            <button onclick="authManager.toggleAutoSave()" id="autoSaveBtn">üö´ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</button>
            <button onclick="dataManager.exportToJSON()">üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON</button>
            <button onclick="dataManager.importFromJSON()">üì§ –ò–º–ø–æ—Ä—Ç –∏–∑ JSON</button>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –¥–µ—Ä–µ–≤–∞ -->
        <div class="tree-container">
            <div id="tree" class="tree"></div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
        <div id="categoryModal" class="modal">
            <div class="modal-content">
                <h3>–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
                <input type="text" id="newCategoryName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏">
                <div>
                    <button onclick="dataManager.addCategory()">–î–æ–±–∞–≤–∏—Ç—å</button>
                    <button onclick="uiManager.hideModals()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>

        <div id="nodeModal" class="modal">
            <div class="modal-content">
                <h3>–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
                <div id="nodeParentSelect">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–π –≤—ã–±–æ—Ä —Ä–æ–¥–∏—Ç–µ–ª—è -->
                </div>
                <input type="text" id="newNodeName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏">
                <div>
                    <button onclick="dataManager.addNode()">–î–æ–±–∞–≤–∏—Ç—å</button>
                    <button onclick="uiManager.hideModals()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>

        <div id="techModal" class="modal">
            <div class="modal-content">
                <h3>–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é</h3>
                <div id="techParentSelect">
                    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–π –≤—ã–±–æ—Ä —Ä–æ–¥–∏—Ç–µ–ª—è -->
                </div>
                <input type="text" id="newTechName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏">
                <div>
                    <button onclick="dataManager.addTechnology()">–î–æ–±–∞–≤–∏—Ç—å</button>
                    <button onclick="uiManager.hideModals()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–µ–∫-–ª–∏—Å—Ç–æ–º -->
        <div id="checklistModal" class="modal">
            <div class="modal-content">
                <div class="checklist-header">
                    <h3 id="checklistTitle">–ß–µ–∫-–ª–∏—Å—Ç</h3>
                    <button onclick="uiManager.hideModals()">‚úï</button>
                </div>
                
                <div class="checklist-stats" id="checklistStats">
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
                
                <div id="checklistItems">
                    <!-- –≠–ª–µ–º–µ–Ω—Ç—ã —á–µ–∫-–ª–∏—Å—Ç–∞ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                </div>
                
                <div class="checklist-actions">
                    <input type="text" id="newChecklistItem" placeholder="–ù–æ–≤—ã–π –ø—É–Ω–∫—Ç —á–µ–∫-–ª–∏—Å—Ç–∞" style="width: calc(100% - 100px);">
                    <button onclick="checklistManager.addChecklistItem()">+ –î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
                
                <div style="margin-top: 15px;">
                    <button onclick="checklistManager.saveChecklist()" class="success">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ–∫-–ª–∏—Å—Ç</button>
                    <button onclick="uiManager.hideModals()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è –¥–ª—è JSON -->
        <div id="jsonSection" class="hidden">
            <h3>JSON –¥–∞–Ω–Ω—ã–µ:</h3>
            <textarea id="jsonOutput" style="width: 100%; height: 200px;"></textarea>
            <div>
                <button onclick="dataManager.copyToClipboard()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å JSON</button>
                <button onclick="dataManager.importFromJSONText()">üì§ –ò–º–ø–æ—Ä—Ç –∏–∑ —ç—Ç–æ–≥–æ JSON</button>
                <button onclick="uiManager.hideJSON()">–°–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å—é
        const techData = {
            categories: []
        };

        // –¢–µ–∫—É—â–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø—É—Ç—å –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        let currentModalPath = [];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            authManager.loadAuth();
            dataManager.loadFromLocalStorage();
            treeManager.init();
            
            // –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω GitHub
            const token = localStorage.getItem('githubToken');
            const owner = localStorage.getItem('repoOwner');
            const repo = localStorage.getItem('repoName');
            
            if (token && owner && repo) {
                console.log('GitHub –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ');
            }
        });

        const treeManager = {
            init() {
                this.treeContainer = document.getElementById('tree');
                this.renderTree();
            },

            renderTree() {
                if (!this.treeContainer) {
                    console.error('Tree container not found');
                    return;
                }
                
                this.treeContainer.innerHTML = '';
                
                if (techData.categories.length === 0) {
                    this.treeContainer.innerHTML = '<p style="text-align: center; color: #6c757d;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é!</p>';
                    return;
                }

                const tree = document.createElement('ul');
                this.buildTree(techData.categories, tree, []);
                this.treeContainer.appendChild(tree);
            },

            buildTree(nodes, parentElement, path) {
                nodes.forEach((node, index) => {
                    const li = document.createElement('li');
                    const currentPath = [...path, index];
                    
                    const nodeElement = document.createElement('div');
                    nodeElement.className = `tree-node ${node.type === 'technology' ? 'technology' : 'category'}`;
                    
                    const completedTasks = node.checklist ? node.checklist.filter(item => item.completed).length : 0;
                    const totalTasks = node.checklist ? node.checklist.length : 0;
                    const progress = totalTasks > 0 ? (completedTasks / totalTasks) * 100 : 0;
                    
                    let statusText = '';
                    let statusClass = '';
                    
                    if (node.type === 'technology') {
                        if (totalTasks === 0) {
                            statusText = 'üìù –í –ø–ª–∞–Ω–∞—Ö';
                            statusClass = 'status-planned';
                        } else if (completedTasks === totalTasks) {
                            statusText = '‚úÖ –ò–∑—É—á–µ–Ω–æ';
                            statusClass = 'status-completed';
                        } else {
                            statusText = 'üöß –í –ø—Ä–æ—Ü–µ—Å—Å–µ';
                            statusClass = 'status-in-progress';
                        }
                    }

                    const nodeContent = document.createElement('div');
                    nodeContent.className = 'node-content';
                    
                    const nameElement = document.createElement('div');
                    nameElement.className = 'node-name';
                    nameElement.textContent = node.name;
                    nodeContent.appendChild(nameElement);

                    if (node.type === 'technology') {
                        const statusElement = document.createElement('div');
                        statusElement.className = statusClass;
                        statusElement.textContent = statusText;
                        nodeContent.appendChild(statusElement);

                        const progressBar = document.createElement('div');
                        progressBar.className = 'progress-bar';
                        const progressFill = document.createElement('div');
                        progressFill.className = 'progress-fill';
                        progressFill.style.width = `${progress}%`;
                        progressBar.appendChild(progressFill);
                        nodeContent.appendChild(progressBar);

                        const progressText = document.createElement('div');
                        progressText.textContent = `${Math.round(progress)}% (${completedTasks}/${totalTasks})`;
                        progressText.style.fontSize = '0.8em';
                        progressText.style.color = '#6c757d';
                        nodeContent.appendChild(progressText);

                        if (node.checklist && node.checklist.length > 0) {
                            const checklistIndicator = document.createElement('div');
                            checklistIndicator.className = 'checklist-indicator';
                            checklistIndicator.textContent = `üìã ${node.checklist.length} –∑–∞–¥–∞—á`;
                            nodeContent.appendChild(checklistIndicator);
                        }
                    }

                    const actionsElement = document.createElement('div');
                    actionsElement.className = 'node-actions';
                    
                    if (node.type === 'technology') {
                        actionsElement.innerHTML = `
                            <button onclick="checklistManager.manageChecklist(${JSON.stringify(path)}, ${index})" class="warning">üìã</button>
                            <button onclick="dataManager.editTechnology(${JSON.stringify(path)}, ${index})">‚úèÔ∏è</button>
                            <button class="delete" onclick="dataManager.deleteTechnology(${JSON.stringify(path)}, ${index})">üóëÔ∏è</button>
                        `;
                    } else {
                        actionsElement.innerHTML = `
                            <button onclick="uiManager.showAddNodeModal(${JSON.stringify(currentPath)})">+ üìÅ</button>
                            <button onclick="uiManager.showAddTechModal(${JSON.stringify(currentPath)})">+ ‚öôÔ∏è</button>
                            <button onclick="dataManager.editNode(${JSON.stringify(path)}, ${index})">‚úèÔ∏è</button>
                            <button class="delete" onclick="dataManager.deleteNode(${JSON.stringify(path)}, ${index})">üóëÔ∏è</button>
                        `;
                    }
                    
                    nodeContent.appendChild(actionsElement);
                    nodeElement.appendChild(nodeContent);
                    li.appendChild(nodeElement);

                    if (node.children && node.children.length > 0) {
                        const childUl = document.createElement('ul');
                        this.buildTree(node.children, childUl, currentPath);
                        li.appendChild(childUl);
                    }

                    parentElement.appendChild(li);
                });
            }
        };

        const dataManager = {
            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—É—Ç—è–º–∏
            getNodeByPath(path) {
                let currentNode = techData.categories;
                for (const index of path) {
                    if (currentNode[index]) {
                        currentNode = currentNode[index].children || [];
                    } else {
                        return null;
                    }
                }
                return currentNode;
            },

            getNodeAtIndex(path, index) {
                const parent = this.getNodeByPath(path);
                return parent ? parent[index] : null;
            },

            // === –õ–û–ö–ê–õ–¨–ù–û–ï –•–†–ê–ù–ò–õ–ò–©–ï ===
            saveToLocalStorage() {
                localStorage.setItem('techData', JSON.stringify(techData));
            },

            loadFromLocalStorage() {
                const saved = localStorage.getItem('techData');
                if (saved) {
                    try {
                        const parsedData = JSON.parse(saved);
                        techData.categories = parsedData.categories || [];
                        treeManager.renderTree();
                    } catch (e) {
                        console.error('Error parsing saved data:', e);
                    }
                }
            },

            // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –î–ê–ù–ù–´–ú–ò ===
            addCategory() {
                const name = document.getElementById('newCategoryName').value.trim();
                if (name) {
                    techData.categories.push({
                        name: name,
                        type: 'category',
                        children: []
                    });
                    treeManager.renderTree();
                    this.saveToLocalStorage();
                    uiManager.hideModals();
                    document.getElementById('newCategoryName').value = '';
                    uiManager.showNotification('–ö–∞—Ç–µ–≥–æ—Ä–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!', 'success');
                    
                    authManager.scheduleAutoSave();
                } else {
                    uiManager.showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏!', 'error');
                }
            },

            addNode() {
                const name = document.getElementById('newNodeName').value.trim();
                
                if (name && currentModalPath.length >= 0) {
                    const parent = this.getNodeByPath(currentModalPath);
                    if (!parent) {
                        uiManager.showNotification('–û—à–∏–±–∫–∞: —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                        return;
                    }

                    parent.push({
                        name: name,
                        type: 'node',
                        children: []
                    });

                    treeManager.renderTree();
                    this.saveToLocalStorage();
                    uiManager.hideModals();
                    document.getElementById('newNodeName').value = '';
                    uiManager.showNotification('–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!', 'success');
                    
                    authManager.scheduleAutoSave();
                } else {
                    uiManager.showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏!', 'error');
                }
            },

            addTechnology() {
                const name = document.getElementById('newTechName').value.trim();
                
                if (name && currentModalPath.length >= 0) {
                    const parent = this.getNodeByPath(currentModalPath);
                    if (!parent) {
                        uiManager.showNotification('–û—à–∏–±–∫–∞: —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                        return;
                    }

                    const tech = {
                        name: name,
                        type: 'technology',
                        checklist: []
                    };

                    parent.push(tech);

                    treeManager.renderTree();
                    this.saveToLocalStorage();
                    uiManager.hideModals();
                    document.getElementById('newTechName').value = '';
                    uiManager.showNotification('–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞!', 'success');
                    
                    authManager.scheduleAutoSave();
                } else {
                    uiManager.showNotification('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏!', 'error');
                }
            },

            // –§—É–Ω–∫—Ü–∏–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            editNode(path, index) {
                const node = this.getNodeAtIndex(path, index);
                if (!node) return;

                const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:', node.name);
                if (newName && newName.trim()) {
                    node.name = newName.trim();
                    treeManager.renderTree();
                    this.saveToLocalStorage();
                    uiManager.showNotification('–ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞!', 'success');
                    authManager.scheduleAutoSave();
                }
            },

            editTechnology(path, index) {
                const node = this.getNodeAtIndex(path, index);
                if (!node) return;

                const newName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:', node.name);
                if (newName && newName.trim()) {
                    node.name = newName.trim();
                    treeManager.renderTree();
                    this.saveToLocalStorage();
                    uiManager.showNotification('–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞!', 'success');
                    authManager.scheduleAutoSave();
                }
            },

            // –§—É–Ω–∫—Ü–∏–∏ —É–¥–∞–ª–µ–Ω–∏—è
            deleteNode(path, index) {
                if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ –≤—Å–µ –µ—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ?')) {
                    const parent = this.getNodeByPath(path);
                    if (parent) {
                        parent.splice(index, 1);
                        treeManager.renderTree();
                        this.saveToLocalStorage();
                        uiManager.showNotification('–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É–¥–∞–ª–µ–Ω–∞!', 'success');
                        authManager.scheduleAutoSave();
                    }
                }
            },

            deleteTechnology(path, index) {
                if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é –∏ –≤—Å–µ –µ—ë –∑–∞–¥–∞—á–∏?')) {
                    const parent = this.getNodeByPath(path);
                    if (parent) {
                        parent.splice(index, 1);
                        treeManager.renderTree();
                        this.saveToLocalStorage();
                        uiManager.showNotification('–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è —É–¥–∞–ª–µ–Ω–∞!', 'success');
                        authManager.scheduleAutoSave();
                    }
                }
            },

            // === –†–ê–ë–û–¢–ê –° JSON ===
            exportToJSON() {
                const jsonOutput = document.getElementById('jsonOutput');
                const jsonSection = document.getElementById('jsonSection');
                
                jsonOutput.value = JSON.stringify(techData, null, 2);
                jsonSection.classList.remove('hidden');
            },

            importFromJSON() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = function(e) {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const parsedData = JSON.parse(e.target.result);
                            techData.categories = parsedData.categories || [];
                            treeManager.renderTree();
                            dataManager.saveToLocalStorage();
                            uiManager.showNotification('–î–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!', 'success');
                            authManager.scheduleAutoSave();
                        } catch (error) {
                            uiManager.showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ JSON —Ñ–∞–π–ª–∞', 'error');
                        }
                    };
                    reader.readAsText(file);
                };
                input.click();
            },

            importFromJSONText() {
                const jsonText = document.getElementById('jsonOutput').value;
                try {
                    const parsedData = JSON.parse(jsonText);
                    techData.categories = parsedData.categories || [];
                    treeManager.renderTree();
                    this.saveToLocalStorage();
                    uiManager.showNotification('–î–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ JSON!', 'success');
                    authManager.scheduleAutoSave();
                } catch (error) {
                    uiManager.showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–∑–±–æ—Ä–µ JSON', 'error');
                }
            },

            copyToClipboard() {
                const jsonOutput = document.getElementById('jsonOutput');
                jsonOutput.select();
                document.execCommand('copy');
                uiManager.showNotification('JSON —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
            }
        };

        // UI Manager –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        const uiManager = {
            showModal(modalId) {
                document.getElementById(modalId).style.display = 'block';
            },

            showAddNodeModal(path = []) {
                currentModalPath = path;
                this.updateParentSelect('nodeModal', path);
                this.showModal('nodeModal');
            },

            showAddTechModal(path = []) {
                currentModalPath = path;
                this.updateParentSelect('techModal', path);
                this.showModal('techModal');
            },

            hideModals() {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.style.display = 'none';
                });
            },

            hideJSON() {
                document.getElementById('jsonSection').classList.add('hidden');
            },

            updateParentSelect(modalId, currentPath) {
                const container = document.getElementById(modalId === 'nodeModal' ? 'nodeParentSelect' : 'techParentSelect');
                if (!container) return;
                
                container.innerHTML = '';
                
                const title = document.createElement('div');
                title.innerHTML = `<strong>–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> ${this.getPathDisplay(currentPath) || '–ö–æ—Ä–µ–Ω—å'}`;
                container.appendChild(title);
            },

            getPathDisplay(path) {
                if (path.length === 0) return '';
                let currentNode = techData.categories;
                let pathNames = [];
                
                for (const index of path) {
                    if (currentNode[index]) {
                        pathNames.push(currentNode[index].name);
                        currentNode = currentNode[index].children || [];
                    }
                }
                
                return pathNames.join(' ‚Üí ');
            },

            showNotification(message, type) {
                const oldNotifications = document.querySelectorAll('.notification');
                oldNotifications.forEach(notif => notif.remove());
                
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }
        };

        const checklistManager = {
            currentChecklist: {
                path: [],
                techIndex: -1
            },

            // === –£–ü–†–ê–í–õ–ï–ù–ò–ï –ß–ï–ö-–õ–ò–°–¢–ê–ú–ò ===
            manageChecklist(path, techIndex) {
                this.currentChecklist = {
                    path,
                    techIndex
                };
                
                const tech = this.getTechnology();
                if (!tech) return;
                
                document.getElementById('checklistTitle').textContent = `–ß–µ–∫-–ª–∏—Å—Ç: ${tech.name}`;
                
                if (!tech.checklist) {
                    tech.checklist = [];
                }
                
                this.renderChecklist();
                uiManager.showModal('checklistModal');
            },
            
            renderChecklist() {
                const tech = this.getTechnology();
                if (!tech) return;
                
                const checklistItems = document.getElementById('checklistItems');
                const checklistStats = document.getElementById('checklistStats');
                
                if (!checklistItems || !checklistStats) return;
                
                checklistItems.innerHTML = '';
                
                if (tech.checklist && tech.checklist.length > 0) {
                    tech.checklist.forEach((item, index) => {
                        const itemElement = document.createElement('div');
                        itemElement.className = `checklist-item ${item.completed ? 'completed' : ''}`;
                        itemElement.innerHTML = `
                            <input type="checkbox" ${item.completed ? 'checked' : ''} 
                                   onchange="checklistManager.toggleChecklistItem(${JSON.stringify(this.currentChecklist.path)}, ${this.currentChecklist.techIndex}, ${index})">
                            <span class="checklist-item-text">${item.text}</span>
                            <button onclick="checklistManager.removeChecklistItem(${index})" class="delete" style="margin-left: 10px;">üóëÔ∏è</button>
                            <button onclick="checklistManager.editChecklistItem(${index})" style="margin-left: 5px;">‚úèÔ∏è</button>
                        `;
                        checklistItems.appendChild(itemElement);
                    });
                } else {
                    checklistItems.innerHTML = '<p style="text-align: center; color: #6c757d;">–ß–µ–∫-–ª–∏—Å—Ç –ø—É—Å—Ç. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π –ø—É–Ω–∫—Ç!</p>';
                }
                
                const completed = tech.checklist ? tech.checklist.filter(item => item.completed).length : 0;
                const total = tech.checklist ? tech.checklist.length : 0;
                const progress = total > 0 ? Math.round((completed / total) * 100) : 0;
                
                checklistStats.innerHTML = `
                    –ü—Ä–æ–≥—Ä–µ—Å—Å: ${completed}/${total} (${progress}%)
                    <div class="progress-bar" style="width: 100%; margin-top: 5px;">
                        <div class="progress-fill" style="width: ${progress}%"></div>
                    </div>
                `;
            },
            
            addChecklistItem() {
                const input = document.getElementById('newChecklistItem');
                if (!input) return;
                
                const text = input.value.trim();
                
                if (text) {
                    const tech = this.getTechnology();
                    if (!tech) return;
                    
                    if (!tech.checklist) {
                        tech.checklist = [];
                    }
                    
                    tech.checklist.push({
                        text: text,
                        completed: false
                    });
                    
                    input.value = '';
                    this.renderChecklist();
                    dataManager.saveToLocalStorage();
                    authManager.scheduleAutoSave();
                    treeManager.renderTree();
                }
            },
            
            removeChecklistItem(index) {
                const tech = this.getTechnology();
                if (!tech) return;
                
                if (tech.checklist && tech.checklist.length > index) {
                    tech.checklist.splice(index, 1);
                    this.renderChecklist();
                    dataManager.saveToLocalStorage();
                    authManager.scheduleAutoSave();
                    treeManager.renderTree();
                }
            },
            
            editChecklistItem(index) {
                const tech = this.getTechnology();
                if (!tech) return;
                
                if (tech.checklist && tech.checklist.length > index) {
                    const newText = prompt('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—É–Ω–∫—Ç:', tech.checklist[index].text);
                    if (newText !== null) {
                        tech.checklist[index].text = newText.trim();
                        this.renderChecklist();
                        dataManager.saveToLocalStorage();
                        authManager.scheduleAutoSave();
                        treeManager.renderTree();
                    }
                }
            },
            
            toggleChecklistItem(path, techIndex, itemIndex) {
                this.currentChecklist = { path, techIndex };
                const tech = this.getTechnology();
                if (!tech) return;
                
                if (tech.checklist && tech.checklist.length > itemIndex) {
                    tech.checklist[itemIndex].completed = !tech.checklist[itemIndex].completed;
                    this.renderChecklist();
                    dataManager.saveToLocalStorage();
                    authManager.scheduleAutoSave();
                    treeManager.renderTree();
                }
            },
            
            saveChecklist() {
                uiManager.hideModals();
                dataManager.saveToLocalStorage();
                uiManager.showNotification('–ß–µ–∫-–ª–∏—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω!', 'success');
                authManager.scheduleAutoSave();
                treeManager.renderTree();
            },
            
            getTechnology() {
                const parent = dataManager.getNodeByPath(this.currentChecklist.path);
                return parent ? parent[this.currentChecklist.techIndex] : null;
            }
        };

        const authManager = {
            autoSaveEnabled: false,
            autoSaveInterval: null,
            lastSaveTime: null,
            autoSaveTimeout: null,

            // === –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø –° –ü–†–û–í–ï–†–ö–û–ô ===
            async testAuth() {
                const token = document.getElementById('githubToken').value;
                const owner = document.getElementById('repoOwner').value;
                const repo = document.getElementById('repoName').value;
                
                if (!token || !owner || !repo) {
                    this.showAuthStatus('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!', 'error');
                    return;
                }

                try {
                    this.showAuthStatus('–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...', 'warning');
                    
                    const response = await fetch(`https://api.github.com/repos/${owner}/${repo}`, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'User-Agent': 'TechDocs-App'
                        }
                    });

                    const responseData = await response.json();

                    if (response.status === 200) {
                        const permissions = responseData.permissions;
                        if (permissions && permissions.push) {
                            this.showAuthStatus('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ! –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∑–∞–ø–∏—Å–∏.', 'success');
                            this.enableAutoSave();
                        } else {
                            this.showAuthStatus('‚ö†Ô∏è –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–æ—Å—Ç—É–ø–µ–Ω, –Ω–æ –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∑–∞–ø–∏—Å—å.', 'warning');
                        }
                    } else if (response.status === 404) {
                        this.showAuthStatus('‚ùå –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è –∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞.', 'error');
                    } else if (response.status === 401) {
                        this.showAuthStatus('‚ùå –û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω.', 'error');
                    } else if (response.status === 403) {
                        this.showAuthStatus('üö´ –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ repo.', 'error');
                    } else {
                        this.showAuthStatus(`‚ùå –û—à–∏–±–∫–∞: ${response.status} - ${responseData.message || response.statusText}`, 'error');
                    }
                } catch (error) {
                    console.error('Auth test error:', error);
                    this.showAuthStatus('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message, 'error');
                }
            },

            saveAuth() {
                const token = document.getElementById('githubToken').value;
                const owner = document.getElementById('repoOwner').value;
                const repo = document.getElementById('repoName').value;
                
                if (token && owner && repo) {
                    localStorage.setItem('githubToken', token);
                    localStorage.setItem('repoOwner', owner);
                    localStorage.setItem('repoName', repo);
                    uiManager.showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
                    setTimeout(() => this.testAuth(), 500);
                } else {
                    uiManager.showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!', 'error');
                }
            },

            loadAuth() {
                const token = localStorage.getItem('githubToken');
                const owner = localStorage.getItem('repoOwner');
                const repo = localStorage.getItem('repoName');
                
                if (token) document.getElementById('githubToken').value = token;
                if (owner) document.getElementById('repoOwner').value = owner;
                if (repo) document.getElementById('repoName').value = repo;
                
                if (token && owner && repo) {
                    setTimeout(() => this.testAuth(), 1000);
                }
            },

            showAuthStatus(message, type) {
                const authStatus = document.getElementById('authStatus');
                if (!authStatus) return;
                
                authStatus.textContent = message;
                authStatus.className = 'auth-status';
                authStatus.classList.add(type === 'success' ? 'auth-success' : 
                                       type === 'warning' ? 'auth-warning' : 'auth-error');
                authStatus.style.display = 'block';
            },

            // === –ê–í–¢–û–°–û–•–†–ê–ù–ï–ù–ò–ï ===
            enableAutoSave() {
                if (this.autoSaveEnabled) return;
                
                this.autoSaveEnabled = true;
                this.updateAutoSaveButton();
                
                this.autoSaveInterval = setInterval(() => {
                    this.autoSaveToGitHub();
                }, 2 * 60 * 1000);
                
                window.addEventListener('beforeunload', this.autoSaveToGitHub.bind(this));
                
                uiManager.showNotification('üîÑ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ (–∫–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã)', 'success');
            },
            
            disableAutoSave() {
                if (this.autoSaveInterval) {
                    clearInterval(this.autoSaveInterval);
                    this.autoSaveInterval = null;
                }
                this.autoSaveEnabled = false;
                this.updateAutoSaveButton();
                window.removeEventListener('beforeunload', this.autoSaveToGitHub.bind(this));
                uiManager.showNotification('‚è∏Ô∏è –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ', 'warning');
            },
            
            toggleAutoSave() {
                if (this.autoSaveEnabled) {
                    this.disableAutoSave();
                } else {
                    this.enableAutoSave();
                }
            },
            
            updateAutoSaveButton() {
                const button = document.getElementById('autoSaveBtn');
                if (!button) return;
                
                if (this.autoSaveEnabled) {
                    button.innerHTML = '‚úÖ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ';
                    button.className = 'auto-save-enabled';
                } else {
                    button.innerHTML = 'üö´ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ';
                    button.className = 'auto-save-disabled';
                }
            },
            
            async autoSaveToGitHub() {
                const token = localStorage.getItem('githubToken');
                const owner = localStorage.getItem('repoOwner');
                const repo = localStorage.getItem('repoName');
                
                if (!token || !owner || !repo || !this.autoSaveEnabled) {
                    return;
                }

                const now = Date.now();
                if (this.lastSaveTime && (now - this.lastSaveTime) < 30000) {
                    return;
                }

                try {
                    console.log('üîÑ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ GitHub...');
                    
                    let sha = null;
                    
                    try {
                        const getResponse = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/tech-data.json`, {
                            headers: {
                                'Authorization': `token ${token}`,
                                'Accept': 'application/vnd.github.v3+json',
                                'User-Agent': 'TechDocs-App'
                            }
                        });
                        
                        if (getResponse.status === 200) {
                            const data = await getResponse.json();
                            sha = data.sha;
                        }
                    } catch (e) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ñ–∞–π–ª–∞ –¥–ª—è –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', e);
                        return;
                    }

                    const content = JSON.stringify(techData, null, 2);
                    const contentBase64 = btoa(unescape(encodeURIComponent(content)));
                    const message = `Auto-save: ${new Date().toLocaleString()}`;
                    
                    const requestBody = {
                        message: message,
                        content: contentBase64
                    };

                    if (sha) {
                        requestBody.sha = sha;
                    }

                    const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/tech-data.json`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json',
                            'User-Agent': 'TechDocs-App'
                        },
                        body: JSON.stringify(requestBody)
                    });

                    if (response.status === 200 || response.status === 201) {
                        this.lastSaveTime = Date.now();
                        console.log('‚úÖ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ');
                        
                        if (!document.hidden) {
                            this.showAutoSaveNotification();
                        }
                    } else {
                        console.warn('‚ö†Ô∏è –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å:', response.status);
                    }
                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                }
            },
            
            showAutoSaveNotification() {
                const notification = document.createElement('div');
                notification.innerHTML = 'üíæ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ';
                notification.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background: #28a745;
                    color: white;
                    padding: 8px 12px;
                    border-radius: 4px;
                    font-size: 12px;
                    z-index: 1002;
                    opacity: 0.9;
                `;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 2000);
            },
            
            scheduleAutoSave() {
                if (!this.autoSaveEnabled) return;
                
                if (this.autoSaveTimeout) {
                    clearTimeout(this.autoSaveTimeout);
                }
                
                this.autoSaveTimeout = setTimeout(() => {
                    this.autoSaveToGitHub();
                }, 10000);
            },

            // === –†–ê–ë–û–¢–ê –° GITHUB API ===
            async loadFromGitHub() {
                const token = localStorage.getItem('githubToken');
                const owner = localStorage.getItem('repoOwner');
                const repo = localStorage.getItem('repoName');
                
                if (!token || !owner || !repo) {
                    uiManager.showNotification('–°–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ—Å—Ç—É–ø –∫ GitHub!', 'error');
                    return;
                }

                try {
                    uiManager.showNotification('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å GitHub...', 'warning');
                    
                    const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/tech-data.json`, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'User-Agent': 'TechDocs-App'
                        }
                    });

                    if (response.status === 200) {
                        const data = await response.json();
                        const content = decodeURIComponent(escape(atob(data.content)));
                        const parsedData = JSON.parse(content);
                        
                        techData.categories = parsedData.categories || [];
                        treeManager.renderTree();
                        dataManager.saveToLocalStorage();
                        uiManager.showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å GitHub!', 'success');
                    } else if (response.status === 404) {
                        uiManager.showNotification('üìù –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª.', 'warning');
                        techData.categories = [];
                        treeManager.renderTree();
                        dataManager.saveToLocalStorage();
                    } else {
                        const errorData = await response.json();
                        throw new Error(`GitHub API error: ${response.status} - ${errorData.message || response.statusText}`);
                    }
                } catch (error) {
                    console.error('GitHub load error:', error);
                    uiManager.showNotification('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message, 'error');
                }
            },

            async saveToGitHub() {
                const token = localStorage.getItem('githubToken');
                const owner = localStorage.getItem('repoOwner');
                const repo = localStorage.getItem('repoName');
                
                if (!token || !owner || !repo) {
                    uiManager.showNotification('–°–Ω–∞—á–∞–ª–∞ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ—Å—Ç—É–ø –∫ GitHub!', 'error');
                    return;
                }

                try {
                    uiManager.showNotification('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ GitHub...', 'warning');
                    
                    if (!techData || techData.categories.length === 0) {
                        uiManager.showNotification('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!', 'error');
                        return;
                    }

                    let sha = null;
                    
                    try {
                        const getResponse = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/tech-data.json`, {
                            headers: {
                                'Authorization': `token ${token}`,
                                'Accept': 'application/vnd.github.v3+json',
                                'User-Agent': 'TechDocs-App'
                            }
                        });
                        
                        if (getResponse.status === 200) {
                            const data = await getResponse.json();
                            sha = data.sha;
                        }
                    } catch (e) {
                        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Ñ–∞–π–ª–∞:', e);
                    }

                    const content = JSON.stringify(techData, null, 2);
                    const contentBase64 = btoa(unescape(encodeURIComponent(content)));
                    const message = `Update tech data: ${new Date().toLocaleString()}`;
                    
                    const requestBody = {
                        message: message,
                        content: contentBase64
                    };

                    if (sha) {
                        requestBody.sha = sha;
                    }

                    const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/tech-data.json`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json',
                            'User-Agent': 'TechDocs-App'
                        },
                        body: JSON.stringify(requestBody)
                    });

                    const responseData = await response.json();

                    if (response.status === 200 || response.status === 201) {
                        uiManager.showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –Ω–∞ GitHub!', 'success');
                    } else {
                        let errorMessage = `–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${response.status}`;
                        if (responseData && responseData.message) {
                            errorMessage += ` - ${responseData.message}`;
                            
                            if (responseData.message.includes('bad credentials')) {
                                errorMessage += '\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞';
                            } else if (responseData.message.includes('not found')) {
                                errorMessage += '\n–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞';
                            } else if (responseData.message.includes('sha')) {
                                errorMessage += '\n–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–Ω–∞—á–∞–ª–∞, –∑–∞—Ç–µ–º —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å';
                            }
                        }
                        throw new Error(errorMessage);
                    }
                } catch (error) {
                    console.error('GitHub save error:', error);
                    uiManager.showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message, 'error');
                }
            }
        };

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                uiManager.hideModals();
            }
        };
    </script>
</body>
</html>
